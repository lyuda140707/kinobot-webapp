<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KinoBot Web App</title>

  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
    }
    .section {
      display: none;
      padding: 20px;
      
    }
    .active {
      display: block;
    }
    .nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: linear-gradient(to right, #0f2027, #203a43, #2c5364); /* –≥—Ä–∞–¥—ñ—î–Ω—Ç */
  display: flex;
  justify-content: space-around;
  padding: 10px 0 6px;
  border-top: 1px solid #333;
  z-index: 999;
  box-shadow: 0 -2px 10px rgba(0, 255, 255, 0.15);
}

.nav button {
  background: none;
  border: none;
  color: #aaa;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 10px;
  transition: all 0.2s ease-in-out;
  position: relative;
}

.nav button span {
  margin-top: 4px;
  font-size: 14px;
}


.nav button.active {
  color: #00f7ff;
  text-shadow: 0 0 6px #00f7ff;
  transform: scale(1.1);
}

.nav button.active::after {
  content: '';
  position: absolute;
  bottom: -3px;
  left: 50%;
  transform: translateX(-50%);
  width: 36%;
  height: 3px;
  border-radius: 3px;
  background: #00f7ff;
  box-shadow: 0 0 8px #00f7ff;
}


 
  .loader {
    border: 4px solid #444;
    border-top: 4px solid #fff;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    display: inline-block;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>

  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">


</head>
<body>

   <div id="home" class="section active" style="padding: 20px;">
  <h2 style="margin-bottom: 10px;">üé¨ –§—ñ–ª—å–º –¥–Ω—è</h2>  
  <div id="film-of-the-day" class="film-day-card">
    <img id="film-img" src="" alt="" />
    <div class="film-title-overlay" id="film-title">–ù–∞–∑–≤–∞</div>
    <button class="film-day-button" onclick="searchInBot('–ù–∞–∑–≤–∞')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>
    <div id="loading-indicator" style="display:none; text-align:center; margin-top:10px; font-size:16px;">
  <span class="loader"></span>
  <div style="margin-top:8px;">–ó–∞—á–µ–∫–∞–π—Ç–µ...</div>
</div>

  </div>






  <div style="margin: 25px 0 10px;">
    <h3>–ñ–∞–Ω—Ä–∏</h3>
    <div style="display:flex; flex-wrap:wrap; gap:10px; padding:10px 0;">
      <button class="genre-btn" data-genre="–ù–æ–≤–∏–Ω–∫–∏">–ù–æ–≤–∏–Ω–∫–∏</button>
      <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ—ó">–ö–æ–º–µ–¥—ñ—ó</button>
      <button class="genre-btn" data-genre="–î—Ä–∞–º–∏">–î—Ä–∞–º–∏</button>
      <button class="genre-btn" data-genre="–°–µ—Ä—ñ–∞–ª–∏">–°–µ—Ä—ñ–∞–ª–∏</button>
      <button class="genre-btn" data-genre="–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏">–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏</button>
    </div>
</div>

<div style="margin-top: 25px;">
  <h3>–î–æ–±—ñ—Ä–∫–∏</h3>
  <div id="collections" style="display:flex; overflow-x:auto; gap:10px; padding:10px 0;"></div>
</div>


 <!-- üéûÔ∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
<div id="categories" class="section">
  <h2>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
  <button class="back-button" onclick="goToHome()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>

  <div class="genre-main-wrapper">
    <div id="genre-main-buttons" class="genre-main-buttons">
      <button class="genre-main-btn fade-in" data-group="films">üéØ –ó–∞ –∂–∞–Ω—Ä–æ–º</button>
      <button class="genre-main-btn fade-in" data-group="series">üì∫ –°–µ—Ä—ñ–∞–ª–∏</button>
      <button class="genre-main-btn fade-in" data-group="cartoons">üëß –ú—É–ª—å—Ç–∏–∫–∏</button>

    </div>
  </div>
  
<!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –ó–∞ –∂–∞–Ω—Ä–æ–º -->
<div id="group-films" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  <button class="genre-btn" data-genre="–ï–∫—à–Ω(–±–æ–π–æ–≤–∏–∫–∏)">üî´ –ï–∫—à–Ω</button>
  <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ—ó">üòÇ –ö–æ–º–µ–¥—ñ—ó</button>
  <button class="genre-btn" data-genre="–î–µ—Ç–µ–∫—Ç–∏–≤–∏">üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤–∏</button>
  <button class="genre-btn" data-genre="–î—Ä–∞–º–∏">üé≠ –î—Ä–∞–º–∏</button>
  <button class="genre-btn" data-genre="–í—ñ–π—Å—å–∫–æ–≤—ñ">ü™ñ –í—ñ–π—Å—å–∫–æ–≤—ñ</button>
  <button class="genre-btn" data-genre="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞">üëΩ –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</button>
  <button class="genre-btn" data-genre="–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ñ">üìö –î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ñ</button>
  <button class="genre-btn" data-genre="–¢—Ä–∏–ª–µ—Ä–∏">üò± –¢—Ä–∏–ª–µ—Ä–∏</button>
  <button class="genre-btn" data-genre="–°—ñ–º–µ–π–Ω—ñ">üë®‚Äçüë©‚Äçüëß –°—ñ–º–µ–π–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ú–µ–ª–æ–¥—Ä–∞–º–∏">üíî –ú–µ–ª–æ–¥—Ä–∞–º–∏</button>
  <button class="genre-btn" data-genre="–ö—Ä–∏–º—ñ–Ω–∞–ª">üöî –ö—Ä–∏–º—ñ–Ω–∞–ª</button>
  <button class="genre-btn" data-genre="–§–µ–Ω—Ç–µ–∑—ñ">üßù –§–µ–Ω—Ç–µ–∑—ñ</button>
  <button class="genre-btn" data-genre="–ü—Ä–∏–≥–æ–¥–∏">üåç –ü—Ä–∏–≥–æ–¥–∏</button>
  <button class="genre-btn" data-genre="–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ">üè∞ –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ">üíò –†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ñ–∞—Ö–∏">üëª –ñ–∞—Ö–∏</button>
</div>

<!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –°–µ—Ä—ñ–∞–ª–∏ -->
<div id="group-series" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  <button class="genre-btn" data-genre="–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ</button>
  <button class="genre-btn" data-genre="–î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ñ">üïµÔ∏è‚Äç‚ôÄÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ñ</button>
  <button class="genre-btn" data-genre="–î—Ä–∞–º–∞—Ç–∏—á–Ω—ñ">üé≠ –î—Ä–∞–º–∞—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ü—Ä–∏–≥–æ–¥–Ω–∏—Ü—å–∫—ñ">üåÑ –ü—Ä–∏–≥–æ–¥–Ω–∏—Ü—å–∫—ñ</button>
  <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ–π–Ω—ñ">üòÇ –ö–æ–º–µ–¥—ñ–π–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ú–µ–ª–æ–¥—Ä–∞–º–∏">üíî –ú–µ–ª–æ–¥—Ä–∞–º–∏</button>
  <button class="genre-btn" data-genre="–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ">üè∞ –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–§–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω—ñ">üëΩ –§–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ö—Ä–∏–º—ñ–Ω–∞–ª—å–Ω—ñ">üöî –ö—Ä–∏–º—ñ–Ω–∞–ª—å–Ω—ñ</button>
</div>

<!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –ú—É–ª—å—Ç–∏–∫–∏ -->
<div id="group-cartoons" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  
</div>

  <div id="genre-results" style="margin-top:20px;"></div>
</div>



  <!-- ‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω–µ -->
<div id="favorites" class="section">
  <h2>–£–ª—é–±–ª–µ–Ω–µ</h2>
  <button class="back-button" onclick="goToHome()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  <p>–°–ø–∏—Å–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤...</p>
</div>

  <!-- üîç –ü–æ—à—É–∫ -->
  <div id="search" class="section">
  <h2>–ü–æ—à—É–∫</h2>
  <button class="back-button" onclick="goToHome()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
    <input
      type="text"
      id="searchInput"
      placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–±–æ –∂–∞–Ω—Ä..."
      style="width:100%;padding:10px;"
      oninput="searchFilms()"
    />
    <div id="searchResults" style="margin-top: 20px;"></div>
  </div>
  

  <!-- –ú–µ–Ω—é –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó -->
<div class="nav">
  <button class="nav-btn active" data-tab="home">üè†<span>–ì–æ–ª–æ–≤–Ω–∞</span></button>
  <button class="nav-btn" data-tab="categories">üéûÔ∏è<span>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</span></button>
  <button class="nav-btn" data-tab="favorites">üíõ<span>–£–ª—é–±–ª–µ–Ω–µ</span></button>
  <button class="nav-btn" data-tab="search">üîç<span>–ü–æ—à—É–∫</span></button>
</div>



  <script>
 
    let films = [];

    function showCollections(collections) {
  const container = document.getElementById('collections');
  container.innerHTML = collections.map(name => {
    let example = films.find(f => f['–î–æ–±—ñ—Ä–∫–∞']?.toLowerCase() === name.toLowerCase());
    if (!example) {
      example = films[0]; // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–µ—Ä—à–∏–π —Ñ—ñ–ª—å–º —è–∫ –∑–∞–≥–ª—É—à–∫—É
    }
    return `
      <div class="collection-card" onclick="getFilmsByCollection('${name}')">
        <img src="${example.–§–æ—Ç–æ || 'https://via.placeholder.com/150'}" alt="${name}" />
        <p>${name}</p>
      </div>
    `;
  }).join('');
}



    

    async function loadFilms() {
  const res = await fetch('https://opensheet.vercel.app/1LlkMITwr1sXyQI_jmfhrhEPXB2L22MCh8GIXNm5aoTQ/Sheet1');
  films = await res.json();

  const collections = [...new Set(films.map(f => f['–î–æ–±—ñ—Ä–∫–∞']).filter(Boolean))];
  showCollections(collections);
   console.log('üéØ –î–æ–±—ñ—Ä–∫–∏:', collections); // üü¢ –æ—Å—å —Ç—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

  showFilmOfTheDay();
}

    
    
   function switchTab(tabId, btn = null) {
  // –•–æ–≤–∞—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó
  document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));

  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —Å–µ–∫—Ü—ñ—è
  const section = document.getElementById(tabId);
  if (!section) {
    console.error(`‚ùå –°–µ–∫—Ü—ñ—è –∑ id="${tabId}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞`);
    alert(`‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞: –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Å–µ–∫—Ü—ñ—é –∑ id="${tabId}"`);
    return;
  }

  // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—É —Å–µ–∫—Ü—ñ—é
  section.classList.add('active');

  // –û–Ω–æ–≤–ª—é—î–º–æ –∫–Ω–æ–ø–∫–∏
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');

  // –û–Ω–æ–≤–ª—é—î–º–æ —É–ª—é–±–ª–µ–Ω–µ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
  if (tabId === 'favorites') {
    showFavorites();
  }
}



    document.addEventListener('DOMContentLoaded', () => {
  window.Telegram.WebApp.ready();

  // –ü—Ä–∏–≤ º—è–∑–∫–∞ –∂–∞–Ω—Ä—ñ–≤
  setTimeout(() => {
    document.querySelectorAll('.genre-btn').forEach(btn => {
      const genre = btn.dataset.genre;
      if (genre) {
        btn.addEventListener('click', () => {
          switchTab('categories', document.querySelector('[data-tab="categories"]'));
          filterByGenre(genre);
        });
      }
    });

    // –ü—Ä–∏–≤ º—è–∑–∫–∞ –≥—Ä—É–ø –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
    document.querySelectorAll('.genre-main-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.dataset.group;
        document.querySelectorAll('.genre-main-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        openGenreGroup(group);
      });
    });

    // –ü—Ä–∏–≤ º—è–∑–∫–∞ –Ω–∏–∂–Ω—å–æ–≥–æ –º–µ–Ω—é
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        switchTab(tabId, btn);
      });
    });
  }, 100); // –Ω–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± DOM —Ç–æ—á–Ω–æ –±—É–≤ –≥–æ—Ç–æ–≤–∏–π
});


    function addToFavorites(title, description) {
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      favorites.push({ title, description });
      localStorage.setItem('favorites', JSON.stringify(favorites));
      alert('–î–æ–¥–∞–Ω–æ –≤ —É–ª—é–±–ª–µ–Ω–µ üíõ');
    }
  
    function showFavorites() {
  const container = document.getElementById('favorites');
  const favorites = JSON.parse(localStorage.getItem('favorites')) || [];

  let html = `
    <h2>–£–ª—é–±–ª–µ–Ω–µ</h2>
    <button class="back-button" onclick="goToHome()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  `;

  if (favorites.length === 0) {
    html += '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ üò¢</p>';
  } else {
    favorites.forEach(item => {
      html += `
        <div style="background:#1c1c1c; padding:10px; margin-bottom:10px; border-radius:8px;">
          <h3>${item.title}</h3>
          <p>${item.description}</p>
        </div>
      `;
    });
  }

  container.innerHTML = html;
}



   function filterByGenre(genre) {
  // –ü–µ—Ä–µ–∫–ª—é—á–∞—î–º–æ –≤–∫–ª–∞–¥–∫—É
  switchTab('categories', document.querySelector('[data-tab="categories"]'));

  setTimeout(() => {
    const container = document.getElementById('genre-results');
    container.innerHTML = `<h3 style="margin-top:10px;">üé¨ ${genre}</h3>`;

    let filtered;

    if (genre === '–ù–æ–≤–∏–Ω–∫–∏') {
      filtered = films.slice(-10).reverse();
    } else {
      filtered = films.filter(film =>
        film['–ñ–∞–Ω—Ä']?.toLowerCase().includes(genre.toLowerCase())
      );
    }

    if (filtered.length === 0) {
      container.innerHTML += `<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>`;
      return;
    }

    container.innerHTML += filtered.map(film => `
      <div style="
        background: linear-gradient(145deg, #1c1c1c, #2c2c2c);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      ">
        <img src="${film['–§–æ—Ç–æ']}" alt="${film['–ù–∞–∑–≤–∞']}" style="width:100%; border-radius:10px; margin-bottom:15px;">
        <h3 style="margin-bottom:5px;">${film['–ù–∞–∑–≤–∞']}</h3>
        <p style="opacity:0.85;">${film['–û–ø–∏—Å']}</p>
        <button class="search-button" data-query="${film['–ù–∞–∑–≤–∞'].replace(/'/g, "\\'")}"
          style="margin-top:12px; background:#e50914; color:#fff; padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-weight:bold;">
          ‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å
        </button>
      </div>
    `).join('');

    container.querySelectorAll('.search-button').forEach(button => {
      button.addEventListener('click', () => {
        const query = button.getAttribute('data-query');
        handleSearchWithSpinner(button, query);
      });
    });
  }, 100);
}



function getFilmsByCollection(collectionName) {
  setTimeout(() => {
    const container = document.getElementById('genre-results');
    container.innerHTML = `<h3 style="margin-top:10px;">üéØ –î–æ–±—ñ—Ä–∫–∞: ${collectionName}</h3>`;

    const filtered = films.filter(film =>
      film?.['–î–æ–±—ñ—Ä–∫–∞']?.toLowerCase?.().includes(collectionName.toLowerCase())
    );

    if (filtered.length === 0) {
      container.innerHTML += '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
      return;
    }

    container.innerHTML += filtered.map(film => {
      const title = film?.['–ù–∞–∑–≤–∞'] || '–ë–µ–∑ –Ω–∞–∑–≤–∏';
      const description = film?.['–û–ø–∏—Å'] || '–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π';
      const image = film?.['–§–æ—Ç–æ'] || 'https://via.placeholder.com/300x180?text=No+Image';

      return `
        <div style="
          background: linear-gradient(145deg, #1c1c1c, #2c2c2c);
          padding: 15px;
          margin-bottom: 20px;
          border-radius: 15px;
          box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        ">
          <img src="${image}" alt="${title}" style="width:100%; border-radius:10px; margin-bottom:15px;">
          <h3 style="margin-bottom:5px;">${title}</h3>
          <p style="opacity:0.85;">${description}</p>
          <button class="search-button" data-query="${title.replace(/'/g, "\\'")}"
            style="margin-top:12px; background:#e50914; color:#fff; padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-weight:bold;">
            ‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å
          </button>
        </div>
      `;
    }).join('');

    container.querySelectorAll('.search-button').forEach(button => {
      button.addEventListener('click', () => {
        const query = button.getAttribute('data-query');
        handleSearchWithSpinner(button, query);
      });
    });
  }, 100);
}


  
   function searchFilms() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const results = films.filter(film =>
    film['–ù–∞–∑–≤–∞'].toLowerCase().includes(query) ||
    film['–ñ–∞–Ω—Ä'].toLowerCase().includes(query) ||
    film['–û–ø–∏—Å'].toLowerCase().includes(query)
  );

  const container = document.getElementById('searchResults');
  if (results.length === 0) {
    container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
    return;
  }

  container.innerHTML = results.map(film => `
    <div style="background:#1c1c1c; padding:10px; margin-bottom:20px; border-radius:10px;">
      <img src="${film['–§–æ—Ç–æ']}" alt="${film['–ù–∞–∑–≤–∞']}" style="max-width:100%; height:auto; border-radius:10px; margin-bottom:10px;">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p>${film['–û–ø–∏—Å']}</p>
      <button class="search-button" data-query="${film['–ù–∞–∑–≤–∞'].replace(/'/g, "\\'")}"
        style="display:inline-block; background:#e50914; color:#fff; padding:10px 20px; border-radius:5px; border:none; cursor:pointer; margin-top:10px;">
        ‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å
      
      </button>
    </div>
  `).join('');

  // ‚¨áÔ∏è –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–Ω–æ–ø–æ–∫
  container.querySelectorAll('.search-button').forEach(button => {
    button.addEventListener('click', () => {
      const query = button.getAttribute('data-query');
      handleSearchWithSpinner(button, query);
    });
  });
}


      // –•–æ–≤–∞—Ç–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –±—É–¥—å-—â–æ, –∫—Ä—ñ–º input
  document.addEventListener('click', (e) => {
    if (e.target.tagName !== 'INPUT') {
      const active = document.activeElement;
      if (active && typeof active.blur === 'function') {
        active.blur();
      }
    }
  });

  // –•–æ–≤–∞—Ç–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –ø—Ä–∏ Enter —É –ø–æ–ª—ñ –ø–æ—à—É–∫—É
  document.getElementById('searchInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      e.target.blur();
    }
  });
async function searchInBot(query) {
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram ID");
    return;
  }

  const user_id = user.id;
  const backendUrl = "https://kinobot-qm9q.onrender.com/search-in-bot";

  // üîΩ –ü–û–ö–ê–ó–ê–¢–ò –°–ü–Ü–ù–ï–†
  document.getElementById("loading-indicator").style.display = "block";

  try {
    const res = await fetch(backendUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user_id, query }),
    });

    const data = await res.json();
    console.log("üì• –í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞:", data);

    if (data.found && data.videoUrl) {
      window.location.href = data.videoUrl;
    } else {
      alert("–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢");
    }
  } catch (err) {
    alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ üò¢");
    console.error(err);
  } finally {
    // üîΩ –°–•–û–í–ê–¢–ò –°–ü–Ü–ù–ï–†
    document.getElementById("loading-indicator").style.display = "none";
  }
}


  function openGenreGroup(group) {
  // –°—Ö–æ–≤–∞—Ç–∏ –≤—Å—ñ –≥—Ä—É–ø–∏
  document.getElementById("group-films").style.display = "none";
  document.getElementById("group-series").style.display = "none";
  const cartoonsGroup = document.getElementById("group-cartoons");
if (cartoonsGroup) {
  cartoonsGroup.style.display = "none";
}


  // –ü–æ–∫–∞–∑–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É
  document.getElementById(`group-${group}`).style.display = "flex";
}

    function showFilmOfTheDay() {
  if (!films.length) return;

  const todayKey = new Date().toDateString();
  const stored = JSON.parse(localStorage.getItem("filmOfTheDay"));

  let film;
  if (stored && stored.date === todayKey) {
    film = stored.film;
  } else {
    film = films[Math.floor(Math.random() * films.length)];
    localStorage.setItem("filmOfTheDay", JSON.stringify({ date: todayKey, film }));
  }

  document.getElementById("film-img").src = film['–§–æ—Ç–æ'];
  document.getElementById("film-img").alt = film['–ù–∞–∑–≤–∞'];
  document.getElementById("film-title").textContent = film['–ù–∞–∑–≤–∞'];

  const button = document.querySelector(".film-day-button");
  if (button) {
    button.setAttribute("onclick", `searchInBot('${film['–ù–∞–∑–≤–∞'].replace(/'/g, "\\'")}')`);
  }
}

  

function goToHome() {
  switchTab('home', document.querySelector('[data-tab="home"]'));
}

    function handleSearchWithSpinner(button, query) {
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram ID");
    return;
  }

  const user_id = user.id;
  const backendUrl = "https://kinobot-qm9q.onrender.com/search-in-bot";

  button.disabled = true;
  button.innerHTML = `<span class="spinner"></span> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...`;

  fetch(backendUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ user_id, query }),
  })
    .then(res => res.json())
    .then(data => {
      if (data.found && data.videoUrl) {
        window.location.href = data.videoUrl;
      } else {
        alert("–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢");
      }
    })
    .catch(err => {
      alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ üò¢");
      console.error(err);
    })
    .finally(() => {
      button.disabled = false;
      button.innerHTML = "‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å";
    });
}
    
// ‚úÖ –ó–∞–ø—É—Å–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ—ñ–ª—å–º—ñ–≤ –ø—ñ—Å–ª—è –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π
loadFilms();

document.addEventListener("DOMContentLoaded", () => {
  const scrollBtn = document.getElementById("scrollToTop");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 200) {
      scrollBtn.style.display = "block";
    } else {
      scrollBtn.style.display = "none";
    }
  });

  scrollBtn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });
});

</script>
  
  <!-- üîù –ö–Ω–æ–ø–∫–∞ "–í–≥–æ—Ä—É" -->
<button id="scrollToTop" style="
  display: none;
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 52px;
  height: 52px;
  background: radial-gradient(circle at 30% 30%, #00f7ff, #008fa0);
  border: none;
  border-radius: 50%;
  font-size: 24px;
  color: #000;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0, 247, 255, 0.4);
  z-index: 1000;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
">
  üîù
</button>


</body>
</html>
