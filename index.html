<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RelaxTime Web App</title>
  <link rel="icon" href="https://example.com/my-favicon.ico">
  <link rel="stylesheet" href="style.css?v=50" />
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <style>

    

    
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
    }
    .section {
      display: none;
      padding: 20px;
    }
    .active {
      display: block;
    }
    .nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      display: flex;
      justify-content: space-around;
      padding: 10px 0 6px;
      border-top: 1px solid #333;
      z-index: 999;
      box-shadow: 0 -2px 10px rgba(0, 255, 255, 0.15);
    }
    .nav button {
      background: none;
      border: none;
      color: #aaa;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 10px;
      transition: all 0.2s ease-in-out;
      position: relative;
    }
    .nav button span {
      margin-top: 4px;
      font-size: 14px;
    }
    .nav button.active {
      color: #00f7ff;
      text-shadow: 0 0 6px #00f7ff;
      transform: scale(1.1);
    }
    .nav button.active::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 36%;
      height: 3px;
      border-radius: 3px;
      background: #00f7ff;
      box-shadow: 0 0 8px #00f7ff;
    }
    
    .back-button {
      background: #444;
      color: #fff;
      padding: 8px 16px;
      margin-bottom: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .loader {
      border: 4px solid #444;
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .skeleton {
  background-color: #333;
  border-radius: 8px;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}
    /* –î–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –ø–æ—è–≤–∏ –º–æ–¥–∞–ª–∫–∏ */
#confirm-modal {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

#confirm-modal.show {
  opacity: 1;
  pointer-events: auto;
}
@keyframes pulse-glow {
  0% {
    text-shadow: 0 0 6px #00f7ff;
    transform: scale(1);
  }
  50% {
    text-shadow: 0 0 15px #00f7ff;
    transform: scale(1.15);
  }
  100% {
    text-shadow: 0 0 6px #00f7ff;
    transform: scale(1);
  }
}

#donate-popup button[onclick="closeDonatePopup()"] {
  font-size: 28px;
  font-weight: bold;
  color: #00f7ff;
  background: none;
  border: none;
  cursor: pointer;
  animation: pulse-glow 2s infinite;
  transition: transform 0.2s ease, text-shadow 0.2s ease;
}


#donate-popup button[onclick="closeDonatePopup()"]:hover {
  transform: scale(1.3);
  text-shadow: 0 0 20px #00f7ff;
}

.series-episodes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 10px;
  margin-top: 10px;
}

.series-episodes-grid .search-button {
  font-size: 11.5px;
  padding: 6px 10px;
  border-radius: 10px;
  white-space: normal;
  line-height: 1.1;
  text-align: center;
}

.rating-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
}

.rating-button {
  background-color: #1b1b1b;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 4px 10px;
  font-size: 14px; /* –∑–º–µ–Ω—à–µ–Ω–æ */
  color: #fff;
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 0 4px rgba(0,255,255,0.2);
  transition: transform 0.2s;
}

.rating-button:hover {
  transform: scale(1.05);
  cursor: pointer;
}

.rating-button.active {
  background: #0ff;
  color: #000;
  font-weight: bold;
  box-shadow: 0 0 12px #0ff;
}

.rating-button.active-like {
  background-color: #2e7d32; /* –ó–µ–ª–µ–Ω–∏–π */
  color: #fff;
}
.rating-button.active-dislike {
  background-color: #c62828; /* –ß–µ—Ä–≤–æ–Ω–∏–π */
  color: #fff;
}

.series-poster {
  width: 100px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
  margin-right: 10px;
  vertical-align: middle;
}

.film-card {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-shadow: 0 0 10px cyan;
}

.film-img {
  width: 100%;
  max-width: 320px;
  border-radius: 8px;
  margin-bottom: 10px;
  object-fit: cover;
}

.film-content {
  text-align: center;
}

.search-button {
  background-color: #00d4ff;
  color: #000;
  border: none;
  border-radius: 20px;
  padding: 6px 14px;
  font-weight: bold;
  margin: 4px;
  cursor: pointer;
}

.favorite-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}
.film-rating {
  font-weight: bold;
  color: #00ffff;
  font-size: 14px;
  margin: 6px 0;
  text-shadow: 0 0 5px rgba(0,255,255,0.3);
  background: rgba(0,255,255,0.1);
  padding: 4px 8px;
  border-radius: 8px;
  display: inline-block;
}

.film-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 10px;
  flex-wrap: wrap;
}    

.film-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin-top: 10px;
  flex-wrap: wrap;
}

  .loader {
    border: 4px solid rgba(255, 255, 255, 0.2);
    border-top: 4px solid #00f7ff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  </style>
 
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="home" class="section active">
    <h2>üéØ –¢–æ–ø –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h2>
   <div id="film-of-the-day" class="film-day-card">
  <div class="image-wrapper" style="position: relative;">
    <img id="film-day-img" src="" alt="–¢–æ–ø –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ">
    <div class="film-title-overlay" id="film-title">–ù–∞–∑–≤–∞ —Ñ—ñ–ª—å–º—É</div>
  </div>
  <div class="btn-container">
    <button id="film-day-button" class="watch-btn">üëÄ –ü–æ–≥–ª—è–Ω—É—Ç–∏</button>
  </div>
</div>



      <div id="home-loading" style="text-align:center; margin-top:30px;">
    <span class="loader"></span>
    <div style="margin-top:8px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  </div>

    
    <h3>–ñ–∞–Ω—Ä–∏</h3>
    <div id="genres" style="display:none; flex-wrap:wrap; gap:10px;"></div>
    

    <h3 style="margin-top:25px">–î–æ–±—ñ—Ä–∫–∏</h3>
  <div id="collections" style="
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 16px;
  padding: 10px 0;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
"></div>

    </div>
  

  <div id="categories" class="section">
  <h2>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
  <button class="back-button" onclick="switchTab('home', document.querySelector('[data-tab=home]'))">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>

<div class="genre-main-wrapper" style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
  <button class="genre-main-btn" onclick="openGenreGroup('films')">üéØ –§—ñ–ª—å–º–∏ –∑–∞ –∂–∞–Ω—Ä–æ–º</button>
  <button class="genre-main-btn" onclick="switchTab('categories'); openGenreGroup('series')">üì∫ –°–µ—Ä—ñ–∞–ª–∏</button>
  <button class="genre-main-btn" onclick="openGenreGroup('cartoons')">üëß –ú—É–ª—å—Ç–∏–∫–∏</button>
</div>



  

   <!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –ó–∞ –∂–∞–Ω—Ä–æ–º -->
<div id="group-films" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  <button class="genre-btn" data-genre="–ï–∫—à–Ω(–±–æ–π–æ–≤–∏–∫–∏)">üî´ –ï–∫—à–Ω</button>
  <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ—ó">üòÇ –ö–æ–º–µ–¥—ñ—ó</button>
  <button class="genre-btn" data-genre="–î–µ—Ç–µ–∫—Ç–∏–≤">üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤</button>
  <button class="genre-btn" data-genre="–î—Ä–∞–º–∏">üé≠ –î—Ä–∞–º–∏</button>
  <button class="genre-btn" data-genre="–í—ñ–π—Å—å–∫–æ–≤—ñ">ü™ñ –í—ñ–π—Å—å–∫–æ–≤—ñ</button>
  <button class="genre-btn" data-genre="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞">üëΩ –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</button>
  <button class="genre-btn" data-genre="–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π">üìö –î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π</button>
  <button class="genre-btn" data-genre="–¢—Ä–∏–ª–µ—Ä–∏">üò± –¢—Ä–∏–ª–µ—Ä–∏</button>
  <button class="genre-btn" data-genre="–°—ñ–º–µ–π–Ω—ñ">üë®‚Äçüë©‚Äçüëß –°—ñ–º–µ–π–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ú–µ–ª–æ–¥—Ä–∞–º–∏">üíî –ú–µ–ª–æ–¥—Ä–∞–º–∏</button>
  <button class="genre-btn" data-genre="–ö—Ä–∏–º—ñ–Ω–∞–ª">üöî –ö—Ä–∏–º—ñ–Ω–∞–ª</button>
  <button class="genre-btn" data-genre="–§–µ–Ω—Ç–µ–∑—ñ">üßù –§–µ–Ω—Ç–µ–∑—ñ</button>
  <button class="genre-btn" data-genre="–ü—Ä–∏–≥–æ–¥–∏">üåç –ü—Ä–∏–≥–æ–¥–∏</button>
  <button class="genre-btn" data-genre="–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ">üè∞ –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ">üíò –†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ñ–∞—Ö–∏">üëª –ñ–∞—Ö–∏</button>
</div>

<!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –°–µ—Ä—ñ–∞–ª–∏ -->
<div id="group-series" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  <button class="genre-btn" data-genre="–£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ</button>
  <button class="genre-btn" data-genre="–î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ñ">üïµÔ∏è‚Äç‚ôÄÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ñ</button>
  <button class="genre-btn" data-genre="–î—Ä–∞–º–∞—Ç–∏—á–Ω—ñ">üé≠ –î—Ä–∞–º–∞—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ü—Ä–∏–≥–æ–¥–Ω–∏—Ü—å–∫—ñ">üåÑ –ü—Ä–∏–≥–æ–¥–Ω–∏—Ü—å–∫—ñ</button>
  <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ–π–Ω—ñ">üòÇ –ö–æ–º–µ–¥—ñ–π–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ú–µ–ª–æ–¥—Ä–∞–º–∞—Ç–∏—á–Ω—ñ ">üíî –ú–µ–ª–æ–¥—Ä–∞–º–∞—Ç–∏—á–Ω—ñ </button>
  <button class="genre-btn" data-genre="–Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ —Å–µ—Ä—ñ–∞–ª–∏">üè∞ –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ —Å–µ—Ä—ñ–∞–ª–∏</button>
  <button class="genre-btn" data-genre="–§–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω—ñ">üëΩ –§–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω—ñ</button>
  <button class="genre-btn" data-genre="–ö—Ä–∏–º—ñ–Ω–∞–ª—å–Ω—ñ">üöî –ö—Ä–∏–º—ñ–Ω–∞–ª—å–Ω—ñ</button>
</div>

<!-- üîΩ –ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: –ú—É–ª—å—Ç–∏–∫–∏ -->
<div id="group-cartoons" class="genre-button-container genre-scroll" style="display:none; margin-top:20px;">
  <button class="genre-btn" data-genre="–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏">üé¨ –ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏</button>
  <button class="genre-btn" data-genre="–ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª–∏">üì∫ –ú—É–ª—å—Ç—Å–µ—Ä—ñ–∞–ª–∏</button>
</div>

   <!-- üîç –§—ñ–ª—å—Ç—Ä –∑–∞ –∫—Ä–∞—ó–Ω–æ—é —Ç–∞ —Ä–æ–∫–æ–º -->
<details id="filter-details" style="margin-top: 20px; margin-bottom: 20px; background: #1c1c1c; border-radius: 10px; padding: 10px 15px;">
  <summary style="font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 10px; color: #00f7ff;">üîé –§—ñ–ª—å—Ç—Ä–∏</summary>
  <div style="padding-top: 10px;">
    <h4 style="margin: 10px 0 5px; color: #ccc;">üåç –ö—Ä–∞—ó–Ω–∞</h4>
    <div id="country-filters" style="
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      max-height: 100px;
      overflow-y: auto;
    "></div>

    <h4 style="margin: 10px 0 5px; color: #ccc;">üìÖ –†—ñ–∫</h4>
    <div id="year-filters" style="
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-height: 100px;
      overflow-y: auto;
    "></div>
  </div>
</details>

  </div>

  <div id="genre-results"></div>
  <div id="list-end-sentinel"></div>
</div>


  <div id="favorites" class="section">
  <h2>–£–ª—é–±–ª–µ–Ω–µ</h2>
  <button class="back-button" onclick="switchTab('account', document.querySelector('[data-tab=account]'))">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
  <div id="fav-list" class="film-list" style="display: none;"></div>
</div>


  <div id="search" class="section">
    <h2>–ü–æ—à—É–∫</h2>
    <button class="back-button" onclick="switchTab('home', document.querySelector('[data-tab=home]'))">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–±–æ –∂–∞–Ω—Ä..." style="width:100%;padding:10px;">
    <div id="searchResults" style="margin-top: 20px;"></div>
  </div>
<!-- ‚úÖ –°–µ–∫—Ü—ñ—è –ê–∫–∞—É–Ω—Ç -->
<section id="account" class="section">
  <h2>üë§ –ê–∫–∞—É–Ω—Ç</h2>

  <hr style="margin: 20px 0; border-color: #444;">
  <h3>üîí PRO –î–æ—Å—Ç—É–ø</h3>
  <p style="font-size:14px; color:#ccc;">–í—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –≤—ñ–¥–µ–æ</p>
  <button id="getProBtn" class="account-button" style="background:#00f7ff; color:#000; font-weight:bold;">üöÄ –û—Ç—Ä–∏–º–∞—Ç–∏ PRO</button>
  <p style="font-size:11px; color:#aaa; margin-top:5px;">–ë—É–¥—å-—è–∫–∞ —Å—É–º–∞ ‚Äî PRO –¥–æ—Å—Ç—É–ø</p>


  <button id="confirmPaidBtn" class="account-button" style="background:#00f7ff; color:#000; font-weight:bold; display:none;">
    ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–≤
  </button>

  <button id="lucky-button" class="account-button">üé≤ –ú–µ–Ω—ñ –ø–æ—â–∞—Å—Ç–∏—Ç—å</button>


<hr style="margin: 20px 0; border-color: #444;">



<div style="margin: 20px 0;">
  <label for="theme-toggle" style="font-weight: bold;">üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞</label>
  <input type="checkbox" id="theme-toggle" />
</div>


  <h3>ü§ù –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç</h3>
  <div style="margin: 20px 0; text-align: center;">
    <a href="https://send.monobank.ua/jar/2FdmSYjoGo" target="_blank" class="btn-donate">‚òï –ù–∞ –∫–∞–≤—É –∞–¥–º—ñ–Ω—É</a>
</div>
</section>

  <div class="nav">
    <button class="nav-btn" data-tab="account">üë§<span>–ê–∫–∞—É–Ω—Ç</span></button>
    <button class="nav-btn active" data-tab="home">üè†<span>–ì–æ–ª–æ–≤–Ω–∞</span></button>
    <button class="nav-btn" data-tab="categories">üéûÔ∏è<span>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</span></button>
    <button class="nav-btn" data-tab="favorites">üíõ<span>–£–ª—é–±–ª–µ–Ω–µ</span></button>
    <button class="nav-btn" data-tab="search">üîç<span>–ü–æ—à—É–∫</span></button>
  </div>

  <div id="loading-indicator" style="display: none;">
  <div class="loader"></div>
  <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ—ñ–ª—å–º—É...</div>
</div>

  <script>


    
    let films = [];
    let isDataLoaded = false;

    const BATCH_SIZE = 50;
    let currentFilms = [];
    let offset = 0;

function renderBatch() {
  const container = document.getElementById('genre-results');
  // –±–µ—Ä–µ–º–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ BATCH_SIZE —Ñ—ñ–ª—å–º—ñ–≤
  const batch = currentFilms.slice(offset, offset + BATCH_SIZE);

  // –±—É–¥—É—î–º–æ HTML-–∫–∞—Ä—Ç–∫–∏
  const html = batch.map(film => `
    <div class="film-card">
      <img src="${film['–§–æ—Ç–æ']}" alt="${film['–ù–∞–∑–≤–∞']}">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p class="film-desc">${film['–û–ø–∏—Å'] || ''}</p>
      <button class="search-button" onclick="openVideo('${film['–ù–∞–∑–≤–∞']}')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>
    </div>
  `).join('');

  // –¥–æ–¥–∞—î–º–æ –¥–æ –∫—ñ–Ω—Ü—è —Å–ø–∏—Å–∫—É
  container.insertAdjacentHTML('beforeend', html);

  // –∑—Å—É–≤–∞—î–º–æ offset
  offset += batch.length;
}

    


  const placeholderImage = "https://i.postimg.cc/zX3VCwWb/31d2242b-94cb-4301-87fd-c7550ca823f4.png";


  document.querySelectorAll('.film-card').forEach(card => {
  const filmName = card.querySelector('h3').textContent;
  const saved = localStorage.getItem(`rating-${filmName}`);
  if (!saved) return;

  const buttons = card.querySelectorAll('.rating-button');
  buttons.forEach(btn => {
    if (saved === 'like' && btn.textContent.includes('üëç')) {
      btn.classList.add('active-like');
    }
    if (saved === 'dislike' && btn.textContent.includes('üëé')) {
      btn.classList.add('active-dislike');
    }
  });
});
async function loadFilms() {
  const cached = localStorage.getItem('films');
  const ts = localStorage.getItem('filmsTimestamp');
  const maxAge = 1000 * 60 * 60 * 48; // 48 –≥–æ–¥–∏–Ω

  if (cached && ts && (Date.now() - Number(ts) < maxAge)) {
    films = JSON.parse(cached);
    shuffleArray(films);
    console.log('‚úÖ –§—ñ–ª—å–º–∏ –∑ –∫–µ—à—É');
    showFilmOfTheDay();
    showCollections();
    showGenres();
    showCountryFilters();
    showYearFilters();
isDataLoaded = true;    // ‚Üê –¥–æ–¥–∞–ª–∏
    return;
  }

  await fetchAndUpdateFilms();
isDataLoaded = true;       // ‚Üê —ñ —Ç—É—Ç
}



async function fetchAndUpdateFilms() {
  try {
    document.getElementById('home-loading').style.display = 'block';

    const res = await fetch('https://opensheet.vercel.app/1LlkMITwr1sXyQI_jmfhrhEPXB2L22MCh8GIXNm5aoTQ/Sheet1');
    films = await res.json();
    shuffleArray(films);


    localStorage.setItem('films', JSON.stringify(films));
    localStorage.setItem('filmsTimestamp', Date.now().toString()); // –∑–±–µ—Ä–µ–≥–ª–∏ —á–∞—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–µ—à—É
    showFilmOfTheDay();
    showCollections();
    showGenres();
    showCountryFilters();
    showYearFilters();
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ—ñ–ª—å–º—ñ–≤:', error);
  } finally {
    document.getElementById('home-loading').style.display = 'none';
  }
}





let pendingLink = "";

async function openVideo(filmName) {
  const tg = window.Telegram.WebApp;

  if (!tg || !tg.initDataUnsafe || !tg.initDataUnsafe.user || !tg.initDataUnsafe.user.id) {
    alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à Telegram ID. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
    return;
  }

  const user = tg.initDataUnsafe.user;

  // üîí –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É PRO
  const isPro = localStorage.getItem('isProUser') === 'true';
  const film = films.find(f => f['–ù–∞–∑–≤–∞'] === filmName);

  if (film?.['–î–æ—Å—Ç—É–ø'] === 'PRO' && !isPro) {
    showProPrompt();
    return;
  }

  document.getElementById("loading-indicator").style.display = "block";

  // ‚õî –ó–∞–±–ª–æ–∫—É—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ "–î–∏–≤–∏—Ç–∏—Å—å" –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏
  document.querySelectorAll('.search-button').forEach(btn => btn.disabled = true);
  setTimeout(() => {
    document.querySelectorAll('.search-button').forEach(btn => btn.disabled = false);
  }, 3000);

  // ‚è≥ –ó–∞—Ç—Ä–∏–º–∫–∞ 2 —Å–µ–∫—É–Ω–¥–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Ç–æ–º
  setTimeout(async () => {
    try {
      const response = await fetch('https://kinobot-qm9q.onrender.com/send-film', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: user.id,
          film_name: filmName
        })
      });

      const data = await response.json();
      console.log("üé¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å —Å–µ—Ä–≤–µ—Ä–∞:", data);

      if (data.success) {
        showRedirectButton();
      } else {
        alert(`‚ùóÔ∏è –ü–æ–º–∏–ª–∫–∞: ${data.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}`);
      }
    } catch (error) {
      console.error('‚ùóÔ∏è –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ:', error);
      alert("‚ùóÔ∏è –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ —Ñ—ñ–ª—å–º—É");
    } finally {
      document.getElementById("loading-indicator").style.display = "none";
    }
  }, 2000);
}

function openVideoById(fileId) {
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à Telegram ID");
    return;
  }

  document.getElementById("loading-indicator").style.display = "block";

  setTimeout(async () => {
    try {
      const response = await fetch('https://kinobot-qm9q.onrender.com/send-film-id', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: user.id,
          file_id: fileId
        })
      });

      const data = await response.json();

      if (data.success) {
        showRedirectButton();
      } else {
        alert(`‚ùóÔ∏è –ü–æ–º–∏–ª–∫–∞: ${data.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}`);
      }
    } catch (error) {
      console.error(error);
      alert("‚ùóÔ∏è –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ —Ñ—ñ–ª—å–º—É");
    } finally {
      document.getElementById("loading-indicator").style.display = "none";
    }
  }, 2000);
}
    

    
function showRedirectButton() {
  const videoWrapper = document.getElementById('video-wrapper');
  videoWrapper.innerHTML = ''; // –æ—á–∏—â–∞—î–º–æ –≤—ñ–∫–Ω–æ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É

  const message = document.createElement('div');
  message.textContent = "‚úÖ –§—ñ–ª—å–º –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!";
  message.style.marginTop = "10px";
  message.style.color = "#00f7ff";
  message.style.fontSize = "18px";
  message.style.fontWeight = "bold";

  const buttonsWrapper = document.createElement('div');
  buttonsWrapper.style.display = 'flex';
  buttonsWrapper.style.gap = '15px';
  buttonsWrapper.style.marginTop = '20px';
  buttonsWrapper.style.justifyContent = 'center';
  buttonsWrapper.style.flexWrap = 'wrap';

  // –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –±–æ—Ç–∞"
  const confirmButton = document.createElement('button');
  confirmButton.className = "watch-btn";
  confirmButton.textContent = "üé¨ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É";
  confirmButton.style.padding = "10px 20px";
  confirmButton.style.borderRadius = "10px";
  confirmButton.style.background = "#00f7ff";
  confirmButton.style.color = "#000";
  confirmButton.style.fontWeight = "bold";
  confirmButton.style.cursor = "pointer";
  confirmButton.style.boxShadow = "0 0 10px #00f7ff";
  confirmButton.onclick = () => {
    window.Telegram.WebApp.close();
  };

  // –ö–Ω–æ–ø–∫–∞ "–ù—ñ, –∑–∞–ª–∏—à–∏—Ç–∏—Å—å —Ç—É—Ç"
  const cancelButton = document.createElement('button');
  cancelButton.className = "watch-btn";
  cancelButton.textContent = "‚ùå –ó–∞–ª–∏—à–∏—Ç–∏—Å—å —Ç—É—Ç";
  cancelButton.style.padding = "10px 20px";
  cancelButton.style.borderRadius = "10px";
  cancelButton.style.background = "#444";
  cancelButton.style.color = "#fff";
  cancelButton.style.fontWeight = "bold";
  cancelButton.style.cursor = "pointer";
  cancelButton.onclick = () => {
    const overlay = document.getElementById('video-overlay');
    overlay.style.opacity = '0';
    setTimeout(() => {
      overlay.style.display = 'none';
    }, 300);
  };

  buttonsWrapper.appendChild(confirmButton);
  buttonsWrapper.appendChild(cancelButton);

  videoWrapper.appendChild(message);
  videoWrapper.appendChild(buttonsWrapper);

  const overlay = document.getElementById('video-overlay');
  overlay.style.display = 'flex';
  setTimeout(() => {
    overlay.style.opacity = '1';
  }, 50);
}



function confirmOpen() {
  const modal = document.getElementById('confirm-modal');
  modal.classList.remove('show');
  setTimeout(() => {
    try {
      if (window.Telegram?.WebApp?.openLink) {
        window.Telegram.WebApp.openLink(pendingLink);
      } else {
        window.open(pendingLink, '_blank');
      }
    } catch (e) {
      console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –ª—ñ–Ω–∫—É:', e);
      window.open(pendingLink, '_blank');
    } finally {
      pendingLink = "";
    }
  }, 200); // ‚Üê –û—Å—å —Ü—è –∫–æ–º–∞ —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è
}

function cancelOpen() {
  const modal = document.getElementById('confirm-modal');
  modal.classList.remove('show');
  pendingLink = "";
}





function closeVideo() {
  const videoOverlay = document.getElementById('video-overlay');
  const videoWrapper = document.getElementById('video-wrapper');

  videoWrapper.innerHTML = '';
  videoOverlay.style.opacity = '0';
  setTimeout(() => {
    videoOverlay.style.display = 'none';
  }, 400);
}






function showFilmOfTheDay() {
  document.getElementById('film-day-img').classList.remove('skeleton');
  document.getElementById('film-day-img').style.background = 'none';

  const film = films[Math.floor(Math.random() * films.length)];
  document.getElementById('film-day-img').src = film['–§–æ—Ç–æ'];

  document.getElementById('film-day-button').onclick = () => {
    const videoUrl = film['–ü–æ—Å–∏–ª–∞–Ω–Ω—è']; // ‚¨ÖÔ∏è —Ç—É—Ç —Ç–µ–ø–µ—Ä '–ü–æ—Å–∏–ª–∞–Ω–Ω—è'
    openVideo(film['–ù–∞–∑–≤–∞']); // ‚¨ÖÔ∏è –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ
  };

  document.getElementById('film-title').textContent = film['–ù–∞–∑–≤–∞'];
}


    function showSkeletonFilmOfTheDay() {
  document.getElementById('film-day-img').style.background = '#333';
  document.getElementById('film-day-img').classList.add('skeleton');
  document.getElementById('film-title').textContent = '';
}




    function showGenres() {
  const genres = ['–ù–æ–≤–∏–Ω–∫–∏', '–ö–æ–º–µ–¥—ñ—ó', '–î—Ä–∞–º–∏', '–°–µ—Ä—ñ–∞–ª–∏', '–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏'];
  document.getElementById('genres').innerHTML = genres.map(g => {
    if (g === '–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏') {
      return `<button class="genre-btn" onclick="goToCartoons()">üëß ${g}</button>`;
    }
    return `<button class="genre-btn" onclick="filterByGenre('${g}')">${g}</button>`;
  }).join('');
  document.getElementById('genres').style.display = 'flex';
}

    
    function showCountryFilters() {
  const countries = [...new Set(films.map(f => f['–ö—Ä–∞—ó–Ω–∞']).filter(Boolean))];
  const container = document.getElementById('country-filters');
  container.innerHTML = countries.map(country => `
    <button class="genre-btn" onclick="filterByCountry('${country}')">${country}</button>
  `).join('');
  container.style.display = 'flex';
}

function showYearFilters() {
  const years = [...new Set(films.map(f => f['–†—ñ–∫']).filter(Boolean))];
  const container = document.getElementById('year-filters');
  container.innerHTML = years.map(year => `
    <button class="genre-btn" onclick="filterByYear('${year}')">${year}</button>
  `).join('');
  container.style.display = 'flex';
}

    

    function showCollections() {
  const container = document.getElementById('collections');
  const names = [...new Set(films.map(f => f['–î–æ–±—ñ—Ä–∫–∞']).filter(Boolean))];
  container.innerHTML = names.map(name => {
    const img = films.find(f => f['–î–æ–±—ñ—Ä–∫–∞'] === name)?.['–§–æ—Ç–æ'] || '';
    return `
      <div class="collection-card" onclick="filterByGenre('${name}')">
        <img src="${img}" alt="${name}">
        <p>${name}</p>
      </div>
    `;
  }).join('');
  document.getElementById('collections').style.display = 'flex';
}

    
function showSeries(type = '–°–µ—Ä—ñ–∞–ª') {
  const container = document.getElementById('genre-results');
  container.innerHTML = '';

  const seriesFilms = films.filter(f => f['–¢–∏–ø'] === type);

  if (seriesFilms.length === 0) {
    container.innerHTML = '<p>–ù–µ–º–∞—î —Å–µ—Ä—ñ–∞–ª—ñ–≤ üò¢</p>';
    return;
  }

  const grouped = {};
  seriesFilms.forEach(f => {
    const name = f['–ù–∞–∑–≤–∞'];
    if (!grouped[name]) grouped[name] = [];
    grouped[name].push(f);
  });

  container.innerHTML = Object.entries(grouped).map(([title, episodes]) => {
    const safe = safeId(title);
    return `
      <div class="series-group">
        <div class="series-header">
          <span class="series-icon">üì∫</span>
          <span class="series-title">${title}</span>
          <button class="search-button" onclick="toggleSeries('${safe}', this)" style="margin-left:10px;">üì∫ –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–µ—Ä—ñ—ó (${episodes.length})</button>
        </div>
        <div id="series-${safe}" style="display:none; margin-top:10px;">
        
          ${episodes.map(ep => {
            const isPro = localStorage.getItem('isProUser') === 'true';
            const isProFilm = ep['–î–æ—Å—Ç—É–ø'] === 'PRO';
            const imgSrc = (isProFilm && !isPro) ? placeholderImage : (ep['–ü–æ—Å—Ç–µ—Ä'] || 'default.jpg');

            const name = ep['–ù–∞–∑–≤–∞'] || title;
            const desc = ep['–û–ø–∏—Å'] || '';
            const imdb = ep['IMDb'] || "‚Äî";
            const likes = Number(ep['–õ–∞–π–∫–∏']) || 0;
            const dislikes = Number(ep['–î–∏–∑–ª–∞–π–∫–∏']) || 0;
            const safeKey = safeId(name);

            let button = '';
            if (isProFilm && !isPro) {
              button = `<button class="search-button" onclick="showProModal()">üîí PRO –î–æ—Å—Ç—É–ø</button>`;
            } else {
              button = `<button class="search-button" onclick="sendFilm('${ep['file_id']}')">üé¨ –î–∏–≤–∏—Ç–∏—Å—å</button>`;
            }

            return `
              <div class="film-card">
                <img src="${imgSrc}" class="film-img" />
                <div class="film-info">
                  <div class="film-title">${name}</div>
                  <div class="film-description">${desc}</div>
                  <div class="film-rating">
                    IMDb: ${imdb} | 
                    üëç <span id="like-count-${safeKey}">${likes}</span> |
                    üëé <span id="dislike-count-${safeKey}">${dislikes}</span>
                  </div>
                  <div class="film-actions">
                    ${button}
                    <button class="fav-button" onclick="addToFavorites('${name}', '${desc}')">üíõ –£–ª—é–±–ª–µ–Ω–µ</button>
                  </div>
                  <div style="margin-top:6px; display:flex; gap:10px;">
                    <button class="rating-button" onclick="rateFilm('${name}', 'like')">üëç <span id="like-count-btn-${safeKey}">${likes}</span></button>
                    <button class="rating-button" onclick="rateFilm('${name}', 'dislike')">üëé <span id="dislike-count-btn-${safeKey}">${dislikes}</span></button>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
  }).join('');

  container.scrollIntoView({ behavior: 'smooth' });
}





function openSeries(id) {
  const block = document.getElementById(`series-${id}`);
  if (block) {
    block.style.display = (block.style.display === 'none') ? 'block' : 'none';
  }
}


  function safeId(str) {
    return str.replace(/[^\w\d]/g, '_');
  }
    
function filterByGenre(genre) {
  switchTab('categories');
  // –≤—ñ–¥–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –ø—ñ–¥—Ö–æ–¥—è—â—ñ —Ñ—ñ–ª—å–º–∏ –≤ currentFilms
  currentFilms = films.filter(f =>
    f['–ñ–∞–Ω—Ä']?.toLowerCase() === genre.toLowerCase() ||
    f['–î–æ–±—ñ—Ä–∫–∞']?.toLowerCase() === genre.toLowerCase()
  );

  const container = document.getElementById('genre-results');
  // —è–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  if (currentFilms.length === 0) {
    container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
    return;
  }

  // –æ—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ —ñ —Å–∫–∏–¥–∞—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
  container.innerHTML = '';
  offset = 0;

  // —Ä–µ–Ω–¥–µ—Ä–∏–º–æ –ø–µ—Ä—à–∏–π batch
  renderBatch();
}


function restoreRatingsUI() {
  document.querySelectorAll('.film-card').forEach(card => {
    const filmName = card.querySelector('h3')?.textContent;
    const saved = localStorage.getItem(`rating-${filmName}`);
    if (!saved) return;

    const likeBtn = card.querySelector('.rating-button:nth-child(1)');
    const dislikeBtn = card.querySelector('.rating-button:nth-child(2)');

    if (likeBtn && dislikeBtn) {
      if (saved === 'like') {
        likeBtn.classList.add('active-like');
      }
      if (saved === 'dislike') {
        dislikeBtn.classList.add('active-dislike');
      }
    }
  });
}


    
    function filterByCountry(country) {
  switchTab('categories');
  const container = document.getElementById('genre-results');

  const filtered = films.filter(f => f['–ö—Ä–∞—ó–Ω–∞'] === country);

  if (filtered.length === 0) {
    container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
    return;
  }

  container.innerHTML = filtered.map(film => {
  const isProFilm = film['–î–æ—Å—Ç—É–ø'] === 'PRO';
  const isPro = localStorage.getItem('isProUser') === 'true';

  let buttons = '';
  if (isProFilm && !isPro) {
    buttons = `<button class="search-button" onclick="showProModal()">üîí PRO –î–æ—Å—Ç—É–ø</button>`;

  } else if (film['–ü–æ—Å–∏–ª–∞–Ω–Ω—è']) {
    buttons = `<button class="search-button" onclick="event.stopPropagation(); openVideo('${film['–ù–∞–∑–≤–∞']}')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>`;
  }

  const imgSrc = (isProFilm && !isPro) ? placeholderImage : film['–§–æ—Ç–æ'];

  return `
    <div class="film-card">
      <img src="${imgSrc}" alt="${film['–ù–∞–∑–≤–∞']}">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p>${film['–û–ø–∏—Å']}</p>
      <div class="film-actions">
        ${buttons}
        <button class="fav-button" onclick="event.stopPropagation(); addToFavorites('${film['–ù–∞–∑–≤–∞']}', '${film['–û–ø–∏—Å']}')">üíõ –£–ª—é–±–ª–µ–Ω–µ</button>
      </div>
    </div>
  `;
}).join('');


  container.scrollIntoView({ behavior: 'smooth' });
}


  

function filterByYear(year) {
  switchTab('categories');
  const container = document.getElementById('genre-results');
  const isPro = localStorage.getItem('isProUser') === 'true';

  const filtered = films.filter(f => f['–†—ñ–∫']?.toString() === year.toString());

  if (filtered.length === 0) {
    container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
    return;
  }

  container.innerHTML = filtered.map(film => {
  const isProFilm = film['–î–æ—Å—Ç—É–ø'] === 'PRO';
  const isPro = localStorage.getItem('isProUser') === 'true';

  let buttons = '';
  if (isProFilm && !isPro) {
    buttons = `<button class="search-button" onclick="alert('üîí –§—ñ–ª—å–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è PRO –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤')">üîí PRO –î–æ—Å—Ç—É–ø</button>`;
  } else if (film['–ü–æ—Å–∏–ª–∞–Ω–Ω—è']) {
    buttons = `<button class="search-button" onclick="event.stopPropagation(); openVideo('${film['–ù–∞–∑–≤–∞']}')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>`;
  }

  const imgSrc = (isProFilm && !isPro) ? placeholderImage : film['–§–æ—Ç–æ'];

  return `
    <div class="film-card">
      <img src="${imgSrc}" alt="${film['–ù–∞–∑–≤–∞']}">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p>${film['–û–ø–∏—Å']}</p>
      <div class="film-actions">
        ${buttons}
        <button class="fav-button" onclick="event.stopPropagation(); addToFavorites('${film['–ù–∞–∑–≤–∞']}', '${film['–û–ø–∏—Å']}')">üíõ –£–ª—é–±–ª–µ–Ω–µ</button>
      </div>
    </div>
  `;
}).join('');


  container.scrollIntoView({ behavior: 'smooth' });
}




   function showFavorites() {
  document.querySelectorAll('.film-card').forEach(el => el.remove());

  const container = document.getElementById('fav-list');
  container.innerHTML = '';

  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');

  if (favs.length === 0) {
    container.innerHTML = '<p>–ù–µ–º–∞—î —É–ª—é–±–ª–µ–Ω–∏—Ö</p>';
  } else {
    container.innerHTML = favs.map(f => `
      <div class="film-card">
        <h3>${f.title}</h3>
        <p>${f.description}</p>
        <button class="remove-fav-btn" onclick="removeFromFavorites(${favs.indexOf(f)})">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
        <!-- –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≤—ñ–¥–µ–æ -->
        <button class="search-button" onclick="event.stopPropagation(); openVideo('${f.title}')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>
      </div>
    `).join('');
  }

  container.style.display = 'block';
}

function showProModal() {
  const modal = document.getElementById('pro-modal');
  modal.style.display = 'flex';
  setTimeout(() => modal.style.opacity = '1', 50);
}

function closeProModal() {
  const modal = document.getElementById('pro-modal');
  modal.style.opacity = '0';
  setTimeout(() => modal.style.display = 'none', 300);
}

  
// ‚¨áÔ∏è –°—é–¥–∏ –≤—Å—Ç–∞–≤–ª—è—î—à –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é
function removeFromFavorites(index) {
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  favs.splice(index, 1);
  localStorage.setItem('favorites', JSON.stringify(favs));
  showFavorites(); // –æ–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫
}



    function searchInBot(query) {
      // üßπ –ü–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤
document.getElementById('history-list').innerHTML = '';
document.getElementById('searchResults').innerHTML = '';
document.querySelectorAll('.film-card').forEach(card => card.remove());

  // ‚ùóÔ∏è–°–ø–æ—á–∞—Ç–∫—É —Ö–æ–≤–∞—î–º–æ –≤—Å—ñ —Å–µ–∫—Ü—ñ—ó (–ø—Ä–∏–±–∏—Ä–∞—î –≤—ñ–∑—É–∞–ª—å–Ω–∏–π "–ø–µ—Ä–µ–∫—ñ—Å")
  document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

  // ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω—É
  document.getElementById('home').classList.add('active');
  document.querySelector('[data-tab=home]')?.classList.add('active');

  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;
  if (!user) return alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram ID");

  document.getElementById("loading-indicator").style.display = "block";

  // –û—á–∏—â–∞—î–º–æ –ø–æ—à—É–∫
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';

  fetch('https://kinobot-qm9q.onrender.com/search-in-bot', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_id: user.id, query })
  }).then(r => r.json()).then(d => {
    if (d.found && d.videoUrl) {
      const existing = JSON.parse(localStorage.getItem('history') || '[]');
      if (!existing.find(f => f.title === query)) {
        const film = films.find(f => f['–ù–∞–∑–≤–∞'] === query);
        if (film) {
          existing.unshift({ title: film['–ù–∞–∑–≤–∞'], description: film['–û–ø–∏—Å'] });
          if (existing.length > 20) existing.pop();
          localStorage.setItem('history', JSON.stringify(existing));
        }
      }
      window.location.href = d.videoUrl;
    } else {
      alert("–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢");
    }
  }).catch(console.error).finally(() => {
    document.getElementById("loading-indicator").style.display = "none";
  });
}


    
    function openGenreGroup(group) {
  // ‚ùå –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –í–°–Ü –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
  document.getElementById("group-films").style.display = "none";
  document.getElementById("group-series").style.display = "none";
  document.getElementById("group-cartoons").style.display = "none";

  // ‚ùå –û—á–∏—Å—Ç–∏—Ç–∏ –≤–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ—à—É–∫—É —Ñ—ñ–ª—å–º—ñ–≤
  const container = document.getElementById('genre-results');
  if (container) {
    container.innerHTML = '';
  }

  // ‚úÖ –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É –≥—Ä—É–ø—É
  const block = document.getElementById("group-" + group);
  if (block) block.style.display = "flex";
}


  function switchTab(tabId, btn) {
  document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

  // üßπ –û—á–∏—â–∞—î–º–æ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
  const containersToClear = [
    'genre-results',
    'searchResults',
    'fav-list'
  ];
  containersToClear.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.innerHTML = '';
  });

  // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç—ñ –∫–∞—Ä—Ç–∫–∏
  document.querySelectorAll('.film-card.expanded').forEach(el => el.classList.remove('expanded'));

  const target = document.getElementById(tabId);
  if (target) target.classList.add('active');
  if (btn) btn.classList.add('active');

  if (tabId === 'favorites') showFavorites();
  if (tabId === 'account') {
    closeDonatePopup();
    window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}


function showSkeletonCollections() {
  const container = document.getElementById('collections');
  container.innerHTML = `
    <div class="film-card skeleton" style="height:200px; width:130px; border-radius:12px;"></div>
    <div class="film-card skeleton" style="height:200px; width:130px; border-radius:12px;"></div>
    <div class="film-card skeleton" style="height:200px; width:130px; border-radius:12px;"></div>
  `;
}


  document.addEventListener('DOMContentLoaded', async () => {
    // –ü—Ä–æ–∫–∏–¥–∞—î–º–æ –±–µ–∫–µ–Ω–¥ Render, —â–æ–± –Ω–µ —Å–ø–∞–≤
  try {
    await fetch('https://kinobot-qm9q.onrender.com/ping');
    console.log('‚úÖ –ë–µ–∫–µ–Ω–¥ –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è');
  } catch (e) {
    console.warn('‚ö†Ô∏è –ë–µ–∫–µ–Ω–¥ –Ω–µ –ø—Ä–æ–∫–∏–Ω—É–≤—Å—è:', e);
  }

  fetch('https://kinobot-qm9q.onrender.com/ping').catch(console.warn);
  Telegram.WebApp.ready();
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à Telegram ID");
    return;
  }

  localStorage.removeItem('films');


  try {
    const res = await fetch('https://kinobot-qm9q.onrender.com/check-subscription', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ user_id: user.id })
    });

 
    const data = await res.json();

   if (!data.subscribed) {
  document.body.innerHTML = `
    <div style="
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #00f7ff;
      text-align: center;
      padding: 20px;
      font-family: 'Russo One', sans-serif;
    ">
      <h1 style="font-size: 28px; margin-bottom: 20px;">‚ùó –©–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º</h1>
      <h2 style="font-size: 22px; margin-bottom: 40px;">–ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª üé•</h2>

     <h2 style="font-size: 22px; margin-bottom: 40px;">–ê–∫—Ç–∏–≤—É–π—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É üé¨</h2>

<div style="display: flex; flex-direction: column; gap: 15px;">
  <a href="https://t.me/KinoTochkaUA" target="_blank" style="
    background: #00f7ff;
    color: #000;
    padding: 15px 30px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    text-decoration: none;
    box-shadow: 0 0 15px #00f7ff;
  ">üé¨ –î–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É</a>

  <a href="https://t.me/KinoTochkaFilms" target="_blank" style="
    background: #00f7ff;
    color: #000;
    padding: 15px 30px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: bold;
    text-decoration: none;
    box-shadow: 0 0 15px #00f7ff;
  ">üé¨ –î–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É</a>
</div>

      <p style="margin-top: 40px; font-size: 16px; color: #ccc;">–ü—ñ—Å–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ –æ–Ω–æ–≤—ñ—Ç—å –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ üì≤</p>
    </div>
  `;
  return;
}

// ‚úÖ –¢—É—Ç –≤—Å—Ç–∞–≤–ª—è—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É PRO
  const proRes = await fetch('https://kinobot-qm9q.onrender.com/check-pro', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_id: user.id })
  });
  const proData = await proRes.json();

  if (proData.isPro) {
    localStorage.setItem('isProUser', 'true');
  } else {
    localStorage.removeItem('isProUser');
  }

const getProBtn = document.getElementById('getProBtn');
if (proData.isPro && getProBtn) {
    getProBtn.style.display = 'none';

    const proNotice = document.createElement('p');
    proNotice.textContent = `‚úÖ –í–∞—à PRO –∞–∫—Ç–∏–≤–Ω–∏–π –¥–æ ${proData.expire_date || "–∫—ñ–Ω—Ü—è –ø–µ—Ä—ñ–æ–¥—É"}`;
    proNotice.style.color = "#00f7ff";
    proNotice.style.marginTop = "15px";
    getProBtn.parentNode.insertBefore(proNotice, getProBtn.nextSibling);
}


    
  fetch('https://kinobot-qm9q.onrender.com/reactivate-user', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_id: user.id })
  }).catch(console.warn);

  

  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å–∫–∏', error);
    alert("‚ùó –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å–∫–∏");
    return;
  }

  // üü¢ –Ø–∫—â–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π, —Ç—ñ–ª—å–∫–∏ —Ç–æ–¥—ñ –≤—Å–µ —ñ–Ω—à–µ:
  

  // –û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É —Ä–∞–∑ –Ω–∞ –¥–æ–±—É
  const lastClear = localStorage.getItem('lastClear');
  const now = Date.now();
  if (!lastClear || now - lastClear > 1000 * 60 * 60 * 24) {
    localStorage.removeItem('films');
    localStorage.setItem('lastClear', now);
  }

  // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–∫–µ–ª–µ—Ç–æ–Ω–∏
  showSkeletonCollections();
  showSkeletonFilmOfTheDay();

  // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ—ñ–ª—å–º–∏ —ñ —Ñ–∞–∫—Ç–∏
  await loadFilms();

  // --- Lazy load observer ---
const sentinel = document.getElementById('list-end-sentinel');
const observer = new IntersectionObserver(entries => {
  if (entries[0].isIntersecting && offset < currentFilms.length) {
    renderBatch();
    restoreRatingsUI();   // –æ–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–π—Ç–∏–Ω–≥ –≤ –Ω–æ–≤–∏—Ö –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
  }
}, {
  rootMargin: '200px'
});
observer.observe(sentinel);

  

    // –Ø–∫—â–æ —á–µ—Ä–µ–∑ 6 —Å–µ–∫—É–Ω–¥ —Ñ—ñ–ª—å–º–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏—Å—å ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
  setTimeout(() => {
    if (!films.length) {
      alert("‚ö†Ô∏è –ú–æ–∂–ª–∏–≤–æ, —Å–ª–∞–±–∫–∏–π —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç. –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫.");
    }
  }, 6000);

 

  // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –∫—Ä–∞—ó–Ω —ñ —Ä–æ–∫—ñ–≤
  showCountryFilters();
  showYearFilters();

  // –¢–µ–º–Ω–∞ —Ç–µ–º–∞
  const toggle = document.getElementById('theme-toggle');
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'light') {
    document.body.classList.add('light-theme');
    toggle.checked = true;
  }
  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.body.classList.add('light-theme');
      localStorage.setItem('theme', 'light');
    } else {
      document.body.classList.remove('light-theme');
      localStorage.setItem('theme', 'dark');
    }
  });

  // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–æ–≥–æ—Ä–∏
  const scrollTopBtn = document.getElementById('scrollTopBtn');
  if (scrollTopBtn) {
    scrollTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollTopBtn.classList.add('show');
      } else {
        scrollTopBtn.classList.remove('show');
      }
    });
  }

  // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      switchTab(tab, btn);
    });
  });

  // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∂–∞–Ω—Ä—ñ–≤
  document.querySelectorAll('.genre-btn').forEach(button => {
    button.addEventListener('click', () => {
      const genre = button.getAttribute('data-genre');
      filterByGenre(genre);
    });
  });

  // –ü–æ—à—É–∫
  document.getElementById('searchInput').addEventListener('input', () => {
    const val = document.getElementById('searchInput').value.toLowerCase();
    const results = [];
    const seenTitles = new Set();

    films.forEach(f => {
      const title = f['–ù–∞–∑–≤–∞'].toLowerCase();
      if (title.includes(val) && !seenTitles.has(title)) {
        results.push(f);
        seenTitles.add(title);
        }
      });
    
    if (results.length === 0) {
      document.getElementById('searchResults').innerHTML = `
        <p>–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>
        <button class="suggest-button" onclick="suggestFilm()">‚ûï –ó–∞–º–æ–≤–∏—Ç–∏ —Ñ—ñ–ª—å–º –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è</button>
      `;
    } else {
      
document.getElementById('searchResults').innerHTML = results.map(f => {
  const isProFilm = f['–î–æ—Å—Ç—É–ø'] === 'PRO';
  const isPro = localStorage.getItem('isProUser') === 'true';
  const imgSrc = (isProFilm && !isPro) ? placeholderImage : f['–§–æ—Ç–æ'];

  let buttons = '';
  if (isProFilm && !isPro) {
    buttons = `<button class="search-button" onclick="showProModal()">üîí PRO –î–æ—Å—Ç—É–ø</button>`;
  } else if (f['–¢–∏–ø'] === '–°–µ—Ä—ñ–∞–ª') {
    buttons = `<button class="search-button" onclick="goToSeries('${f['–ù–∞–∑–≤–∞']}')">üì∫ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ —Å–µ—Ä—ñ–∞–ª—É</button>`;
  } else if (f['–ü–æ—Å–∏–ª–∞–Ω–Ω—è']) {
    buttons = `<button class="search-button" onclick="event.stopPropagation(); openVideo('${f['–ù–∞–∑–≤–∞']}')">‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å</button>`;
  }

  return `
    <div class="film-card fade-in">
      <img src="${imgSrc}" alt="${f['–ù–∞–∑–≤–∞']}">
      <h3>${f['–ù–∞–∑–≤–∞']}</h3>
      <p class="film-desc">${f['–û–ø–∏—Å']}</p>

      <div class="film-rating">
        IMDb: ${f['IMDb'] || "‚Äî"} | 
        üëç <span id="like-count-${safeId(f['–ù–∞–∑–≤–∞'])}">${f['–õ–∞–π–∫–∏'] || 0}</span> |
        üëé <span id="dislike-count-${safeId(f['–ù–∞–∑–≤–∞'])}">${f['–î–∏–∑–ª–∞–π–∫–∏'] || 0}</span>
      </div>

      <div class="film-actions">
        ${buttons}
        <button class="fav-button" onclick="event.stopPropagation(); addToFavorites('${f['–ù–∞–∑–≤–∞']}', '${f['–û–ø–∏—Å']}')">üíõ –£–ª—é–±–ª–µ–Ω–µ</button>
      </div>

      <div style="margin-top:6px; display:flex; gap:10px;">
        <button class="rating-button" onclick="rateFilm('${f['–ù–∞–∑–≤–∞']}', 'like')">üëç <span id="like-count-btn-${safeId(f['–ù–∞–∑–≤–∞'])}">${f['–õ–∞–π–∫–∏'] || 0}</span></button>
        <button class="rating-button" onclick="rateFilm('${f['–ù–∞–∑–≤–∞']}', 'dislike')">üëé <span id="dislike-count-btn-${safeId(f['–ù–∞–∑–≤–∞'])}">${f['–î–∏–∑–ª–∞–π–∫–∏'] || 0}</span></button>
      </div>
    </div>
  `;
}).join('');

// ‚úÖ –í–°–¢–ê–í –°–Æ–î–ò:
restoreRatingsUI();


    }
  });

  // –ö–ª—ñ–∫ –ø–æ –∫–∞—Ä—Ç—Ü—ñ
  document.addEventListener('click', (e) => {
    const card = e.target.closest('.film-card');
    if (card && !e.target.closest('button')) {
      card.classList.toggle('expanded');
    }
  });

});



  function addToFavorites(title, description, videoUrl) {
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  
  if (favs.find(f => f.title === title)) {
    alert('–í–∂–µ –≤ —É–ª—é–±–ª–µ–Ω–æ–º—É üíõ');
    return;
  }

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ñ—ñ–ª—å–º –∑ URL
  favs.push({ title, description, videoUrl });

  // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Å–ø–∏—Å–æ–∫ —É LocalStorage
  localStorage.setItem('favorites', JSON.stringify(favs));

  // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ "–£–ª—é–±–ª–µ–Ω–∏—Ö"
  showFavorites(); 

  // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  alert('–î–æ–¥–∞–Ω–æ –≤ —É–ª—é–±–ª–µ–Ω–µ!');
}


  

document.getElementById("lucky-button").addEventListener("click", () => {
  if (!films.length) {
    alert("‚è≥ –§—ñ–ª—å–º–∏ —â–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏—Å—å");
    return;
  }

  const randomFilm = films[Math.floor(Math.random() * films.length)];
  alert(`üé¨ ${randomFilm['–ù–∞–∑–≤–∞']}\n\n${randomFilm['–û–ø–∏—Å'] || ''}`);
});

     let isSending = false;
async function requestWithRetry(url, options, retries = 3, delay = 1000) {
  for (let i = 0; i < retries; i++) {
    try {
      const res = await fetch(url, options);
      if (res.ok) return res;
    } catch (e) {
      console.warn(`‚ö†Ô∏è –°–ø—Ä–æ–±–∞ ${i + 1} –Ω–µ –≤–¥–∞–ª–∞—Å—è`);
    }
    await new Promise(resolve => setTimeout(resolve, delay));
  }
  throw new Error("‚ùå –£—Å—ñ —Å–ø—Ä–æ–±–∏ –∑–∞–ø–∏—Ç—É –Ω–µ –≤–¥–∞–ª–∏—Å—è");
}


function rateFilm(filmName, action) {
  const key = `rating-${safeId(filmName)}`;
  const previousAction = localStorage.getItem(key);

  if (previousAction === action) return;
  localStorage.setItem(key, action);

  fetch('https://kinobot-qm9q.onrender.com/rate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      film_name: filmName,
      action: action,
      undo: previousAction
    }),
  });

  // ‚úÖ –í—Å—Ç–∞–≤–ª—è—î—à —Ü–µ ‚Üì –∑–∞–º—ñ—Å—Ç—å —Å–≤–æ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ –±–ª–æ–∫—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI
  const likeBtnCount = document.getElementById(`like-count-btn-${safeId(filmName)}`);
  const dislikeBtnCount = document.getElementById(`dislike-count-btn-${safeId(filmName)}`);

  const likeDisplay = document.getElementById(`like-count-${safeId(filmName)}`);
  const dislikeDisplay = document.getElementById(`dislike-count-${safeId(filmName)}`);

  if (likeBtnCount && dislikeBtnCount) {
    if (action === 'like') {
      likeBtnCount.textContent = Number(likeBtnCount.textContent) + 1;
      if (previousAction === 'dislike') {
        dislikeBtnCount.textContent = Math.max(0, Number(dislikeBtnCount.textContent) - 1);
      }
    } else {
      dislikeBtnCount.textContent = Number(dislikeBtnCount.textContent) + 1;
      if (previousAction === 'like') {
        likeBtnCount.textContent = Math.max(0, Number(likeBtnCount.textContent) - 1);
      }
    }
  }

  if (likeDisplay && dislikeDisplay) {
    if (action === 'like') {
      likeDisplay.textContent = Number(likeDisplay.textContent) + 1;
      if (previousAction === 'dislike') {
        dislikeDisplay.textContent = Math.max(0, Number(dislikeDisplay.textContent) - 1);
      }
    } else {
      dislikeDisplay.textContent = Number(dislikeDisplay.textContent) + 1;
      if (previousAction === 'like') {
        likeDisplay.textContent = Math.max(0, Number(likeDisplay.textContent) - 1);
      }
    }
  }

  // –í–∏–¥—ñ–ª–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫
  const parent = likeBtnCount?.closest(".film-card");
  const likeBtn = parent?.querySelector(".rating-button:nth-child(1)");
  const dislikeBtn = parent?.querySelector(".rating-button:nth-child(2)");

  likeBtn?.classList.remove("active-like");
  dislikeBtn?.classList.remove("active-dislike");

  if (action === "like") {
    likeBtn?.classList.add("active-like");
  } else {
    dislikeBtn?.classList.add("active-dislike");
  }
}




async function suggestFilm() {
  const val = document.getElementById('searchInput').value.trim();
  if (!val || isSending) return;

  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;
  if (!user) return;

  isSending = true;

  const btn = document.querySelector(".suggest-button");
  if (btn) {
    btn.disabled = true;
    setTimeout(() => btn.disabled = false, 7000);
  }

  document.getElementById('request-loading').style.display = 'flex'; // ‚è≥ –ü–æ–∫–∞–∑–∞—Ç–∏

  try {
    await fetch('https://kinobot-qm9q.onrender.com/ping');
    await new Promise(resolve => setTimeout(resolve, 1000));

    const res = await requestWithRetry('https://kinobot-qm9q.onrender.com/request-film', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ user_id: user.id, film_name: val })
    });

    const contentType = res.headers.get("content-type");
    if (contentType && contentType.includes("application/json")) {
      const data = await res.json();
      showSuggestResult({
        success: data.ok !== false,
        remaining_requests: data.remaining_requests || '‚àû',
        is_pro: data.is_pro
      });
    } else {
      showSuggestResult({
        success: false,
        is_pro: false,
        remaining_requests: 0
      });
    }

  } catch (error) {
    console.error(error);
    showSuggestResult({
      success: false,
      is_pro: false,
      remaining_requests: 0
    });
  } finally {
    isSending = false;
    document.getElementById('request-loading').style.display = 'none'; // ‚õî –°—Ö–æ–≤–∞—Ç–∏
  }
}

  

    function toggleHistory() {
  const container = document.getElementById('history-list');
  if (container.style.display === 'block') {
    container.style.display = 'none';
  } else {
    showHistory();
  }
}



// ‚úÖ –í–ò–ù–ï–°–ò –æ–∫—Ä–µ–º–æ —Ñ—É–Ω–∫—Ü—ñ—é rate() –ø—ñ—Å–ª—è showHistory
function rate(title, stars) {
  localStorage.setItem(`rating_${title}`, stars);
  showHistory();
}


function clearHistory() {
  localStorage.removeItem('history');
  showHistory(); // –æ–¥—Ä–∞–∑—É –æ–Ω–æ–≤–ª—é—î –≤–∏–≤—ñ–¥
}
      
 

   function goToCartoons() {
  switchTab('categories', document.querySelector('[data-tab=categories]'));
  openGenreGroup('cartoons');

  // –î–æ–¥–∞—î–º–æ –ø–ª–∞–≤–Ω—É –ø—Ä–æ–∫—Ä—É—Ç–∫—É —á–µ—Ä–µ–∑ 300 –º—Å, –∫–æ–ª–∏ –≤—Å–µ –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è
  setTimeout(() => {
    const target = document.getElementById('group-cartoons');
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, 300);
}

function closeDonatePopup() {
  const popup = document.getElementById('donate-popup');
  if (popup) {
    popup.style.opacity = '0';
    setTimeout(() => {
      popup.style.display = 'none';
    }, 300);
  }
}
// ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–∞–±—ñ–ª—å–Ω–µ –≤—ñ–∫–æ–Ω—Ü–µ –¥–æ–Ω–∞—Ç—É —á–µ—Ä–µ–∑ 20 —Å–µ–∫—É–Ω–¥
setTimeout(() => {
  const popup = document.getElementById('donate-popup');
  if (popup) {
    popup.style.display = 'block';
    popup.style.opacity = '0';
    popup.style.transition = 'opacity 0.5s ease';
    setTimeout(() => popup.style.opacity = '1', 10);
  }
}, 20000);

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function goToSeries(seriesTitle) {
  switchTab('categories', document.querySelector('[data-tab=categories]'));
  openGenreGroup('series');

  setTimeout(() => {
    const filtered = films.filter(f => f['–ù–∞–∑–≤–∞'] === seriesTitle && f['–¢–∏–ø'] === '–°–µ—Ä—ñ–∞–ª');

    if (filtered.length === 0) {
      alert('–°–µ—Ä—ñ–∞–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢');
      return;
    }

    const container = document.getElementById('genre-results');
    const grouped = { [seriesTitle]: filtered };

container.innerHTML = Object.entries(grouped).map(([title, episodes]) => {
  const first = episodes[0];
  const isPro = localStorage.getItem('isProUser') === 'true';
  const isProFilm = first['–î–æ—Å—Ç—É–ø'] === 'PRO';
  const imgSrc = (isProFilm && !isPro) ? placeholderImage : first['–§–æ—Ç–æ'];
  const imdb = first['IMDb'] || "‚Äî";
  const desc = first['–û–ø–∏—Å'] || '';
  const likes = Number(first['–õ–∞–π–∫–∏']) || 0;
  const dislikes = Number(first['–î–∏–∑–ª–∞–π–∫–∏']) || 0;
  const safe = safeId(title);

  return `
    <div class="film-card">
      <img src="${imgSrc}" alt="${title}">
      <h3>${title}</h3>
      <p class="film-desc">${desc}</p>
      <div class="film-rating">
        IMDb: ${imdb} |
        üëç <span id="like-count-${safe}">${likes}</span> |
        üëé <span id="dislike-count-${safe}">${dislikes}</span>
      </div>
      <div class="film-actions">
        ${isProFilm && !isPro 
          ? `<button class="search-button" onclick="showProModal()">üîí PRO –î–æ—Å—Ç—É–ø</button>`
          : episodes.map((ep, i) => {
              return `<button class="search-button" onclick="sendFilm('${ep['file_id']}')">${ep['–û–ø–∏—Å'] || '–°–µ—Ä—ñ—è ' + (i + 1)}</button>`;
            }).join('')}
        <button class="fav-button" onclick="event.stopPropagation(); addToFavorites('${title}', '${desc}')">üíõ –£–ª—é–±–ª–µ–Ω–µ</button>
      </div>
      <div style="margin-top:6px; display:flex; gap:10px;">
        <button class="rating-button" onclick="rateFilm('${title}', 'like')">üëç <span id="like-count-btn-${safe}">${likes}</span></button>
        <button class="rating-button" onclick="rateFilm('${title}', 'dislike')">üëé <span id="dislike-count-btn-${safe}">${dislikes}</span></button>
      </div>
    </div>
  `;
}).join('');


    container.scrollIntoView({ behavior: 'smooth' });
  }, 300);
}

document.getElementById('getProBtn').addEventListener('click', () => {
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe?.user;
    if (!user) {
        alert("‚ùóÔ∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à Telegram ID");
        return;
    }

    const paymentInfo = "üí≥ PRO –¥–æ—Å—Ç—É–ø ‚Äî –±—É–¥—å-—è–∫–∞ —Å—É–º–∞, —â–æ–± –±–æ—Ç –∑–∞–ª–∏—à–∞–≤—Å—è –¥–ª—è —Å–≤–æ—ó—Ö üòâ";
    const paymentLink = "https://send.monobank.ua/jar/2FdmSYjoGo";

    alert(paymentInfo);
    window.open(paymentLink, "_blank");

    showConfirmPaidButton(user); // ‚¨ÖÔ∏è –ü–µ—Ä–µ–¥–∞—î–º–æ –≤–µ—Å—å –æ–± º—î–∫—Ç user
});


function showConfirmPaidButton(user) {
    const btn = document.getElementById("confirmPaidBtn");
    if (!btn) return;

    btn.style.display = "block";
    closeDonatePopup();

    // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ —Å—Ç–∞—Ä—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ —á–µ—Ä–µ–∑ –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏
    const newBtn = btn.cloneNode(true);
    btn.parentNode.replaceChild(newBtn, btn);

    newBtn.onclick = () => {
        const username = (user.username !== undefined) ? user.username : '';
        const first_name = (user.first_name !== undefined) ? user.first_name : '';

        notifyPayment(user.id, username, first_name);
        newBtn.style.display = "none";
    };
}





let isPaymentSending = false;

async function notifyPayment(userId, username, firstName) {
  if (isPaymentSending) {
    showSuggestResult({
      success: false,
      is_pro: false,
      remaining_requests: 0
    });
    return;
  }

  isPaymentSending = true;

  try {
    const res = await fetch('https://kinobot-qm9q.onrender.com/notify-payment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        user_id: userId,
        username: username,
        first_name: firstName
      })
    });

    const data = await res.json();

    if (data.ok) {
      showSuggestResult({
        success: true,
        is_pro: true,
        remaining_requests: 0
      });
    } else {
      showSuggestResult({
        success: false,
        is_pro: false,
        remaining_requests: 0
      });
    }

  } catch (e) {
    console.error(e);
    showSuggestResult({
      success: false,
      is_pro: false,
      remaining_requests: 0
    });
  } finally {
    isPaymentSending = false;
  }
}



function showProPrompt() {
  const overlay = document.getElementById('video-overlay');
  const wrapper = document.getElementById('video-wrapper');

  wrapper.innerHTML = `
    <h3 style="color:#00f7ff;">üîí –§—ñ–ª—å–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è PRO</h3>
    <p style="margin:15px 0;">–ê–∫—Ç–∏–≤—É–π PRO, —â–æ–± –¥–∏–≤–∏—Ç–∏—Å—å —É—Å—ñ —Ñ—ñ–ª—å–º–∏ –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å.</p>
    <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button class="watch-btn" onclick="goToPro()">üöÄ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ PRO</button>
      <button class="watch-btn" onclick="closeVideo()">‚ùå –ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  `;

  overlay.style.display = 'flex';
  setTimeout(() => overlay.style.opacity = '1', 50);
}

function goToPro() {
  const overlay = document.getElementById('video-overlay');
  const wrapper = document.getElementById('video-wrapper');

  wrapper.innerHTML = '';
  overlay.style.opacity = '0';

  setTimeout(() => {
    overlay.style.display = 'none';
    switchTab('account', document.querySelector('[data-tab=account]'));

    // –û–¥—Ä–∞–∑—É —ñ–º—ñ—Ç—É—î–º–æ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏ "–û—Ç—Ä–∏–º–∞—Ç–∏ PRO"
    const getProBtn = document.getElementById('getProBtn');
    if (getProBtn) getProBtn.click();
  }, 300);
}

    
function sendFilm(film_id) {
    if (!isDataLoaded) {
        alert("‚è≥ –î–∞–Ω—ñ —â–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è, –∑–∞—á–µ–∫–∞–π—Ç–µ...");
        return;
    }

    const film = films.find(f => f.file_id === film_id);
    if (!film) {
        alert("‚ùå –§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.");
        return;
    }

    fetch('https://kinobot-qm9q.onrender.com/send-film-id', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            user_id: window.Telegram.WebApp.initDataUnsafe?.user?.id,
            file_id: film_id
        })
    })
    .then(r => r.json())
    .then(res => {
        if (res.success) {
            console.log("‚úÖ –§—ñ–ª—å–º –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ");
        } else {
            alert("‚ùå –°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
        }
    })
    .catch(err => {
        console.error(err);
        alert("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.");
    });
}


    
</script>

<button id="scrollTopBtn" class="scroll-top-btn">üîù</button>

<div id="video-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999; justify-content:center; align-items:center; transition: opacity 0.4s ease;">
  <div id="video-wrapper" style="background:#000; padding:20px; border-radius:12px; max-width:800px; width:90%; text-align:center; box-shadow: 0 0 20px rgba(0, 247, 255, 0.3);">
    <!-- –¢—É—Ç JS –≤—Å—Ç–∞–≤–ª—è—Ç–∏–º–µ –∞–±–æ loader, –∞–±–æ –≤—ñ–¥–µ–æ —á–µ—Ä–µ–∑ innerHTML -->
  </div>
</div>

<div id="confirm-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:#1a1a1a; padding:20px; border-radius:12px; max-width:300px; text-align:center; box-shadow:0 0 20px #00f7ff;">
    <p style="color:#00f7ff; font-size:18px; margin-bottom:20px;">üé¨ –ë–∞–∂–∞—î—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ—ñ–ª—å–º?</p>
    <div style="display:flex; gap:10px; justify-content:center;">
      <button onclick="confirmOpen()" style="padding:8px 16px; background:#00f7ff; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">–¢–∞–∫</button>
      <button onclick="cancelOpen()" style="padding:8px 16px; background:#444; border:none; border-radius:8px; cursor:pointer; color:#fff;">–ù—ñ</button>
    </div>
  </div>
</div>

<div id="donate-popup" style="
  display:none; position:fixed; bottom:120px; left:50%; transform:translateX(-50%);
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
  color:#fff; padding:20px 20px 16px; border-radius:12px; 
  text-align:center; box-shadow:0 0 20px #00f7ff; z-index:9999;
">
  
  <button onclick="closeDonatePopup()" style="
    position:absolute; top:6px; right:10px; background:none; 
    border:none; color:#fff; font-size:20px; cursor:pointer;">‚úñÔ∏è</button>

  <p style="margin-bottom:10px; font-size:16px;">
    <span style="color:#00f7ff;">–¢–≤—ñ–π –¥–æ–Ω–∞—Ç</span> = 
    <span style="color:#ffcc00;">–Ω–∞—à–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ—è</span> –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —â–µ –∫—Ä–∞—â–µ üí™
  </p>

  <a href="https://send.monobank.ua/jar/2FdmSYjoGo" target="_blank" style="
    padding:12px 24px; background:#00f7ff; color:#000; font-weight:bold;
    text-decoration:none; border-radius:10px; display:inline-block;
    box-shadow:0 0 15px #00f7ff; font-size:16px;
  ">‚òï –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ RelaxTime</a>
</div>




<footer style="text-align:center; font-size:12px; color:#666; padding:15px 10px; line-height:1.4;">
  ‚ö†Ô∏è –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –ª–∏—à–µ –¥–ª—è –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è. –Ø–∫—â–æ –º–∏ –ø–æ—Ä—É—à–∏–ª–∏ –≤–∞—à—ñ –∞–≤—Ç–æ—Ä—Å—å–∫—ñ –ø—Ä–∞–≤–∞ ‚Äî –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å: 
  <a href="mailto:relax-time-bot@ukr.net" style="color:#00f7ff; text-decoration:underline;">relax-time-bot@ukr.net</a><br>
  ‚ö†Ô∏è All content is for informational purposes only. If we violated your copyright, contact us.
</footer>

<div id="pro-modal" style="
  display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
  background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
  
  <div style="background:#1a1a1a; padding:20px; border-radius:12px; max-width:300px; text-align:center; box-shadow:0 0 20px #00f7ff;">
    <p style="color:#00f7ff; font-size:18px; margin-bottom:20px;">üîí –§—ñ–ª—å–º –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –¥–ª—è PRO</p>
    <p style="margin-bottom:20px; color:#ccc;">–û—Ñ–æ—Ä–º—ñ—Ç—å PRO, —â–æ–± –¥–∏–≤–∏—Ç–∏—Å—å —É—Å—ñ —Ñ—ñ–ª—å–º–∏ –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å.</p>
     <p style="margin-bottom:16px; color:#888; font-size:13px;">
    üí∏ –ë—É–¥—å-—è–∫–∞ —Å—É–º–∞ ‚Äî —Ü–µ –≤–∂–µ PRO  
    <br>üòâ –ê–ª–µ —á–∏–º –±—ñ–ª—å—à–µ ‚Äî —Ç–∏–º –∫—Ä–∞—â–µ!
   </p>
    <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button onclick="goToPro()" style="padding:8px 16px; background:#00f7ff; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">üöÄ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ PRO</button>
      <button onclick="closeProModal()" style="padding:8px 16px; background:#444; border:none; border-radius:8px; cursor:pointer; color:#fff;">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>
</div>
<script>
  function toggleSeries(id, buttonEl) {
    const allSeriesBlocks = document.querySelectorAll('[id^="series-"]');
    const allButtons = document.querySelectorAll('.search-button');

    // –°—Ö–æ–≤–∞—Ç–∏ –≤—Å—ñ –±–ª–æ–∫–∏ —Å–µ—Ä—ñ–π
    allSeriesBlocks.forEach(block => {
      block.style.display = 'none';
    });

    // –°–∫–∏–Ω—É—Ç–∏ —Ç–µ–∫—Å—Ç —É—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
    allButtons.forEach(btn => {
      if (btn.textContent === 'üîΩ –°—Ö–æ–≤–∞—Ç–∏ —Å–µ—Ä—ñ—ó') {
        btn.textContent = 'üì∫ –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–µ—Ä—ñ—ó';
      }
    });

    const currentBlock = document.getElementById(`series-${id}`);
    if (currentBlock) {
      const isHidden = currentBlock.style.display === 'none';

      // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∏–¥–∏–º–æ—Å—Ç—ñ
      currentBlock.style.display = isHidden ? 'block' : 'none';

      // –ó–º—ñ–Ω–∞ —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–∫–∏
      if (buttonEl) {
        buttonEl.textContent = isHidden ? 'üîΩ –°—Ö–æ–≤–∞—Ç–∏ —Å–µ—Ä—ñ—ó' : 'üì∫ –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–µ—Ä—ñ—ó';
      }

      if (isHidden) {
        setTimeout(() => {
          currentBlock.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 200);
      }
    }
  }
</script>
<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
<div id="suggest-modal" style="
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85); z-index:9999; justify-content:center; align-items:center;
  opacity: 0; transition: opacity 0.3s ease;
">
  <div style="background:#222; padding:22px 20px; border-radius:12px; max-width:310px; text-align:center; box-shadow:0 0 15px #0ff;">
    <div id="suggest-modal-content" style="color:#fff; font-size:16px; line-height:1.5;"></div>
    <div style="margin-top:20px;">
      <button onclick="closeSuggestModal()" style="padding:8px 16px; background:#00f7ff; color:#000; font-weight:bold; border:none; border-radius:8px; cursor:pointer;">–û–ö</button>
    </div>
  </div>
</div>


<script>
function showSuggestResult({ success, remaining_requests, is_pro }) {
  const modal = document.getElementById('suggest-modal');
  const content = document.getElementById('suggest-modal-content');

  if (success) {
    content.innerHTML = `
      ‚úÖ –ó–∞–ø–∏—Ç –Ω–∞ —Ñ—ñ–ª—å–º –ø—Ä–∏–π–Ω—è—Ç–æ!<br><br>
      üÜì –ó–∞–ª–∏—à–∏–ª–æ—Å—å: <b>${remaining_requests}</b> –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.
    `;
  } else if (is_pro) {
    content.innerHTML = `
      ‚ö†Ô∏è –©–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ, –∞–ª–µ —É –≤–∞—Å —î PRO üòé<br><br>
      –ü–æ–≤—Ç–æ—Ä—ñ—Ç—å —Å–ø—Ä–æ–±—É —Ç—Ä–æ—Ö–∏ –ø—ñ–∑–Ω—ñ—à–µ.
    `;
  } else {
    content.innerHTML = `
      ‚õî –í–∏ –≤–∏—á–µ—Ä–ø–∞–ª–∏ –ª—ñ–º—ñ—Ç –∑–∞–ø–∏—Ç—ñ–≤.<br><br>
      üîì <b>–û—Ç—Ä–∏–º–∞–π—Ç–µ PRO</b> —ñ –∑–∞–º–æ–≤–ª—è–π—Ç–µ —Ñ—ñ–ª—å–º–∏ –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å!
    `;
  }

  modal.style.display = 'flex';
  setTimeout(() => modal.style.opacity = '1', 10);
}



  function closeSuggestModal() {
    const modal = document.getElementById('suggest-modal');
    modal.style.opacity = '0';
    setTimeout(() => modal.style.display = 'none', 300);
  }


  async function requestFilm(filmName) {
    const telegramUser = window.Telegram.WebApp.initDataUnsafe?.user;
    if (!telegramUser) {
      alert("‚õî –ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Telegram");
      return;
    }

    const userId = telegramUser.id;

    try {
      const res = await fetch("https://kinobot-qm9q.onrender.com/request-film", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_id: userId, film_name: filmName })
      });

      const data = await res.json();

      showSuggestResult({
        success: res.ok,
        remaining_requests: data?.remaining_requests || 0,
        is_pro: data?.is_pro || false
      });

    } catch (error) {
      console.error("‚ùó –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É:", error);
      // üîª –¢–µ–ø–µ—Ä –ø–æ–∫–∞–∑—É—î –≥–∞—Ä–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ, –∞ –Ω–µ alert
      showSuggestResult({
        success: false,
        remaining_requests: 0,
        is_pro: false
      });
    }
  }
</script>


</div>

<div id="request-loading" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.6);
  z-index: 9999;
  display: none;
  font-size: 18px;
  color: #00f7ff;
  text-align: center;
">
  <div style="
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
  ">
    <div class="loader"></div>
    <div style="margin-top:12px;">–ù–∞–¥—Å–∏–ª–∞—î–º–æ –∑–∞–ø–∏—Ç...</div>
  </div>
</div>


  
</body>
</html>
