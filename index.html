<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KinoBot Web App</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
    }
    .section {
      display: none;
      padding: 20px;
    }
    .active {
      display: block;
    }
    .nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #222;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      border-top: 1px solid #333;
    }
    .nav button {
      background: none;
      border: none;
      color: #aaa;
      font-size: 16px;
      cursor: pointer;
    }
    .nav button.active {
      color: #fff;
      font-weight: bold;
    }
  </style>
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

</head>
<body>

    <div id="home" class="section active" style="padding: 20px;">
  <h2 style="margin-bottom: 10px;">üé¨ –§—ñ–ª—å–º –¥–Ω—è</h2>
  <div style="background-color:#1c1c1c; padding:15px; border-radius:15px; box-shadow: 0 2px 8px rgba(0,0,0,0.5);">
    <img src="https://upload.wikimedia.org/wikipedia/en/4/4e/Game_plan_ver2.jpg" alt="The Game Plan" style="width:100%; border-radius:10px;">
    <h3 style="margin:15px 0 5px;">The Game Plan</h3>
    <p style="margin-bottom:15px;">–ó—ñ—Ä–∫–∞ —Ñ—É—Ç–±–æ–ª—É –¥—ñ–∑–Ω–∞—î—Ç—å—Å—è, —â–æ —É –Ω—å–æ–≥–æ —î –¥–æ–Ω—å–∫–∞.</p>
    <a href="https://t.me/KinoTochkaUA" target="_blank" style="display:inline-block; background:#e50914; color:#fff; padding:10px 20px; border-radius:8px; text-decoration:none; font-weight:bold;">
      ‚ñ∂Ô∏è –î–∏–≤–∏—Ç–∏—Å—å
    </a>
  </div>

  <div style="margin: 25px 0 10px;">
    <h3>–ñ–∞–Ω—Ä–∏</h3>
    <div style="display:flex; overflow-x:auto; gap:10px; padding:10px 0;">
      <button class="genre-btn" data-genre="–ù–æ–≤–∏–Ω–∫–∏">–ù–æ–≤–∏–Ω–∫–∏</button>
      <button class="genre-btn" data-genre="–ö–æ–º–µ–¥—ñ—ó">–ö–æ–º–µ–¥—ñ—ó</button>
      <button class="genre-btn" data-genre="–î—Ä–∞–º–∏">–î—Ä–∞–º–∏</button>
      <button class="genre-btn" data-genre="–°–µ—Ä—ñ–∞–ª–∏">–°–µ—Ä—ñ–∞–ª–∏</button>
      <button class="genre-btn" data-genre="–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏">–ú—É–ª—å—Ç—Ñ—ñ–ª—å–º–∏</button>
    </div>
  </div>

  <div>
    <h3>–î–æ–±—ñ—Ä–∫–∏</h3>
    <div style="display:flex; overflow-x:auto; gap:10px; padding:10px 0;">
      <div style="min-width:120px; background:#222; padding:10px; border-radius:10px;">
        <img src="https://i.postimg.cc/XY1GbWNR/cry.jpg" style="width:100%; border-radius:8px;">
        <p style="margin-top:5px; font-size:14px;">10 —Å–ª—ñ–∑ –ø—ñ–¥ –ø–æ–¥—É—à–∫—É</p>
      </div>
      <div style="min-width:120px; background:#222; padding:10px; border-radius:10px;">
        <img src="https://i.postimg.cc/L6DGMgMz/daddy.jpg" style="width:100%; border-radius:8px;">
        <p style="margin-top:5px; font-size:14px;">–ë–∞—Ç—å–∫–æ —ñ –¥–∏—Ç–∏–Ω–∞</p>
      </div>
      <div style="min-width:120px; background:#222; padding:10px; border-radius:10px;">
        <img src="https://i.postimg.cc/TYwF0mXB/ukr.jpg" style="width:100%; border-radius:8px;">
        <p style="margin-top:5px; font-size:14px;">–¢—ñ–ª—å–∫–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é</p>
      </div>
    </div>
  </div>
</div>

      </div>
      

 <!-- üéûÔ∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
<div id="categories" class="section">
  <h2>–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
  <div id="genre-buttons" style="display:flex; flex-wrap:wrap; gap:10px; padding:10px;">
  <button class="genre-btn" onclick="openGenreGroup('films')">üéØ –ó–∞ –∂–∞–Ω—Ä–æ–º</button>
  <button class="genre-btn" onclick="openGenreGroup('series')">üì∫ –°–µ—Ä—ñ–∞–ª–∏</button>
  <button class="genre-btn" onclick="openGenreGroup('cartoons')">üëß –ú—É–ª—å—Ç–∏–∫–∏</button>
</div>

  <div id="genre-results" style="margin-top:20px;"></div>
</div>



  <!-- ‚ù§Ô∏è –£–ª—é–±–ª–µ–Ω–µ -->
  <div id="favorites" class="section">
    <h2>–£–ª—é–±–ª–µ–Ω–µ</h2>
    <p>–°–ø–∏—Å–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ñ—ñ–ª—å–º—ñ–≤...</p>
  </div>

  <!-- üîç –ü–æ—à—É–∫ -->
  <div id="search" class="section">
    <h2>–ü–æ—à—É–∫</h2>
    <input
      type="text"
      id="searchInput"
      placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–±–æ –∂–∞–Ω—Ä..."
      style="width:100%;padding:10px;"
      oninput="searchFilms()"
    />
    <div id="searchResults" style="margin-top: 20px;"></div>
  </div>
  

  <!-- –ú–µ–Ω—é –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó -->
  <div class="nav">
    <button class="active" onclick="switchTab('home', this)">–ì–æ–ª–æ–≤–Ω–∞</button>
    <button onclick="switchTab('categories', this)">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</button>
    <button onclick="switchTab('favorites', this)">–£–ª—é–±–ª–µ–Ω–µ</button>
    <button onclick="switchTab('search', this)">–ü–æ—à—É–∫</button>
  </div>



  <script>
    

    
    let films = [];
  
    async function loadFilms() {
      const res = await fetch('https://opensheet.vercel.app/1LlkMITwr1sXyQI_jmfhrhEPXB2L22MCh8GIXNm5aoTQ/Sheet1');
      films = await res.json();
    }
  
    window.addEventListener('DOMContentLoaded', () => {
  window.Telegram.WebApp.ready();
  loadFilms();

  // –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ –∂–∞–Ω—Ä—ñ–≤
  document.querySelectorAll('.genre-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const genre = btn.getAttribute('data-genre');
      filterByGenre(genre);
      switchTab('categories', document.querySelector('[onclick*="categories"]'));
    });
  });
});



  
    function switchTab(tabId, btn) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
  
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
  
      if (tabId === 'favorites') {
        showFavorites();
      }
    }
  
    function addToFavorites(title, description) {
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      favorites.push({ title, description });
      localStorage.setItem('favorites', JSON.stringify(favorites));
      alert('–î–æ–¥–∞–Ω–æ –≤ —É–ª—é–±–ª–µ–Ω–µ üíõ');
    }
  
    function showFavorites() {
      const container = document.getElementById('favorites');
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
  
      let html = '<h2>–£–ª—é–±–ª–µ–Ω–µ</h2>';
      if (favorites.length === 0) {
        html += '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ üò¢</p>';
      } else {
        favorites.forEach(item => {
          html += `
            <div style="background:#1c1c1c; padding:10px; margin-bottom:10px; border-radius:8px;">
              <h3>${item.title}</h3>
              <p>${item.description}</p>
            </div>
          `;
        });
      }
      container.innerHTML = html;
    }

    function filterByGenre(genre) {
  const filtered = films.filter(film =>
    film['–ñ–∞–Ω—Ä']?.toLowerCase().includes(genre.toLowerCase())
  );

  const container = document.getElementById('genre-results');
  container.innerHTML = `<h3 style="margin-top:10px;">üé¨ ${genre}</h3>`;

  if (filtered.length === 0) {
    container.innerHTML += `<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>`;
    return;
  }

  container.innerHTML += filtered.map(film => `
    <div style="background:#1c1c1c; padding:10px; margin-bottom:20px; border-radius:10px;">
      <img src="${film['–§–æ—Ç–æ']}" alt="${film['–ù–∞–∑–≤–∞']}" style="max-width:100%; height:auto; border-radius:10px; margin-bottom:10px;">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p>${film['–û–ø–∏—Å']}</p>
      <button class="search-button" data-query="${film['–ù–∞–∑–≤–∞'].replace(/'/g, "\\'")}"
        style="display:inline-block; background:#e50914; color:#fff; padding:10px 20px; border-radius:5px; border:none; cursor:pointer; margin-top:10px;">
        ‚ñ∂Ô∏è –ü–æ—à—É–∫–∞—Ç–∏ –≤ –±–æ—Ç—ñ
      </button>
    </div>
  `).join('');

  // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á—ñ –Ω–∞ –∫–Ω–æ–ø–∫–∏
  container.querySelectorAll('.search-button').forEach(button => {
    button.addEventListener('click', () => {
      const query = button.getAttribute('data-query');
      searchInBot(query);
    });
  });
}

  
   function searchFilms() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const results = films.filter(film =>
    film['–ù–∞–∑–≤–∞'].toLowerCase().includes(query) ||
    film['–ñ–∞–Ω—Ä'].toLowerCase().includes(query) ||
    film['–û–ø–∏—Å'].toLowerCase().includes(query)
  );

  const container = document.getElementById('searchResults');
  if (results.length === 0) {
    container.innerHTML = '<p>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢</p>';
    return;
  }

  container.innerHTML = results.map(film => `
    <div style="background:#1c1c1c; padding:10px; margin-bottom:20px; border-radius:10px;">
      <img src="${film['–§–æ—Ç–æ']}" alt="${film['–ù–∞–∑–≤–∞']}" style="max-width:100%; height:auto; border-radius:10px; margin-bottom:10px;">
      <h3>${film['–ù–∞–∑–≤–∞']}</h3>
      <p>${film['–û–ø–∏—Å']}</p>
      <button class="search-button" data-query="${film['–ù–∞–∑–≤–∞'].replace(/'/g, "\\'")}"
        style="display:inline-block; background:#e50914; color:#fff; padding:10px 20px; border-radius:5px; border:none; cursor:pointer; margin-top:10px;">
        ‚ñ∂Ô∏è –ü–æ—à—É–∫–∞—Ç–∏ –≤ –±–æ—Ç—ñ
      </button>
    </div>
  `).join('');

  // ‚¨áÔ∏è –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–Ω–æ–ø–æ–∫
  container.querySelectorAll('.search-button').forEach(button => {
    button.addEventListener('click', () => {
  const query = button.getAttribute('data-query');
  searchInBot(query);

});


  });
}


      // –•–æ–≤–∞—Ç–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –±—É–¥—å-—â–æ, –∫—Ä—ñ–º input
  document.addEventListener('click', (e) => {
    if (e.target.tagName !== 'INPUT') {
      const active = document.activeElement;
      if (active && typeof active.blur === 'function') {
        active.blur();
      }
    }
  });

  // –•–æ–≤–∞—Ç–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –ø—Ä–∏ Enter —É –ø–æ–ª—ñ –ø–æ—à—É–∫—É
  document.getElementById('searchInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      e.target.blur();
    }
  });
async function searchInBot(query) {
  const tg = window.Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("‚ùóÔ∏è–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ Telegram ID");
    return;
  }

  const user_id = user.id;
  const backendUrl = "https://kinobot-qm9q.onrender.com/search-in-bot";

  console.log("üì§ –ù–∞–¥—Å–∏–ª–∞—î–º–æ –∑–∞–ø–∏—Ç:", { user_id, query });

  const res = await fetch(backendUrl, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ user_id, query })
  });

  const data = await res.json();
  console.log("üì• –í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞:", data);

  if (data.found && data.videoUrl) {
    window.location.href = data.videoUrl;

  } else {
    alert("–§—ñ–ª—å–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üò¢");
  }
}


</script>
  
  
</body>
</html>
